<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <div th:replace="fragments/header :: resources"></div>
    <script type="text/javascript" th:src="@{global/js/JsBarcode.all.min.js}"></script>
    <script type="text/javascript" th:src="@{global/js/bootstrap-datetimepicker.min.js}"></script>
    <script type="text/javascript" th:src="@{global/js/bootstrap-datetimepicker.fr.js}"></script>
    <link type="text/css" rel="stylesheet"
          th:href="@{global/css/bootstrap-datetimepicker.min.css}"/>
    <script type="text/javascript" th:src="@{global/js/echarts.js}"></script>
</head>
<body>
<div th:replace="fragments/header :: headLine"></div>
<iframe id="iframe_display" name="iframe_display" style="display: none;"></iframe>

<div class="container">
    <div class="tab-content">
        <div class="tab-pane active" id="homepage">
            <div th:replace="fragments/header :: homePageSearchInput"></div>
            <a id="modal-changeBookLocation" style="display: none" href="#modal-container-changeBookLocation"
               role="button" class="btn"
               data-toggle="modal"></a>
            <!--改变图书的位置-->
            <div class="modal fade" id="modal-container-changeBookLocation" role="dialog"
                 aria-labelledby="myModalLabelchangeBookLocation"
                 aria-hidden="true">
                <input id="saveCurrentEditedBookId" style="display: none" value="">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title" id="myModalLabelchangeBookLocation">
                                Choice a Book Location
                            </h4>
                        </div>
                        <div class="modal-body">
                            <label for="editBookShelf" class="control-label col-sm-4">Edit Floor Area Shelf ;</label>
                            <div class="btn-group">

                                <button class="btn btn-default" id="editBookFloor"></button>
                                <button data-toggle="dropdown" class="btn btn-default dropdown-toggle"><span
                                        class="caret"></span></button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Floor',this)">1 floor</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Floor',this)">2 floor</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Floor',this)">3 floor</a>
                                    </li>
                                </ul>
                            </div>
                            <div class=" btn-group">
                                <button class="btn btn-default" id="editBookArea"></button>
                                <button data-toggle="dropdown" class="btn btn-default dropdown-toggle"><span
                                        class="caret"></span></button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Area',this)">1 area</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Area',this)">2 area</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Area',this)">3 area</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Area',this)">4 area</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Area',this)">5 area</a>
                                    </li>
                                </ul>
                            </div>
                            <div class=" btn-group">
                                <button class="btn btn-default" id="editBookShelf"></button>
                                <button data-toggle="dropdown" class="btn btn-default dropdown-toggle"><span
                                        class="caret"></span></button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">1 shelf</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">2 shelf</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">3 shelf</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">4 shelf</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">5 shelf</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">6 shelf</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">7 shelf</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">8 shelf</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">9 shelf</a>
                                    </li>
                                    <li>
                                        <a onclick="editBookFloorAndAreaAndShelf('Shelf',this)">10 shelf</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal"
                                    onclick="changeBookLocationShow()">Close
                            </button>
                            <!--   <button type="button" class="btn btn-primary">保存</button>-->
                        </div>
                    </div>
                </div>
                <script type="text/javascript">
                    function editBookFloorAndAreaAndShelf(type, obj) {
                        $("#editBook" + type).text($(obj).text());
                    }

                    function changeBookLocationShow() {
                        $("#bookLocation" + $("#saveCurrentEditedBookId").val() + "")
                            .val($("#editBookFloor").text() + " " + $("#editBookArea").text() + " " + $("#editBookShelf").text())
                    }
                </script>
            </div>

        </div>
        <div class="tab-pane" id="notify">
            <div class="container">
                <div class="row clearfix">
                    <div class="col-md-12 column">
                        <a id="modal-490552" href="#modal-container-sendAnnouncement" style="font-size: 25px;"
                           role="button" class="btn" data-toggle="modal">Click To Send Announcement</a>
                        <div class="modal fade" id="modal-container-sendAnnouncement" role="dialog"
                             aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
                                        </button>
                                        <h4 class="modal-title clearfix" style="font-size: 25px" id="myModalLabel">
                                            Title :
                                        </h4>
                                        <input type="text" class="form-control col-md-3" id="announcementTitle"/>
                                    </div>
                                    <div class="modal-body">
                                        <div style="display: -webkit-box;-webkit-box-orient: horizontal;">
                                            <label class="control-label" style="font-size: 20px">Input The Announcement
                                                : &nbsp;&nbsp;&nbsp;&nbsp;</label>
                                            <div class="btn-group">
                                                <button class="btn btn-default" id="announceMentTyptChoice">Choice
                                                    Announcement Type
                                                </button>
                                                <button data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                                                    <span class="caret"></span></button>
                                                <ul class="dropdown-menu">
                                                    <li>
                                                        <a href="#" class="announcementType" name="">Normal</a>
                                                    </li>
                                                    <li>
                                                        <a href="#" class="announcementType" name="btn-info">Prompt</a>
                                                    </li>
                                                    <li>
                                                        <a href="#" class="announcementType"
                                                           name="btn-danger">Warning</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <textarea style="resize: none" rows="4" class="form-control"
                                                  id="announceBody"></textarea>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close
                                        </button>
                                        <button type="button" class="btn btn-primary" id="sendAnnounceMentBtn">Send
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <script type="text/javascript">
                                var preId;
                                var className = null, typeName;
                                $(".announcementType").click(function () {
                                    typeName = $(this).text();
                                    $("#announceMentTyptChoice").removeClass(className);
                                    className = $(this).prop("name");
                                    $("#announceMentTyptChoice").addClass(className);
                                    $("#announceMentTyptChoice").text(typeName);
                                });

                                $("#sendAnnounceMentBtn").click(function () {
                                    $("#announceMentTyptChoice").text("Choice Announcement Type");
                                    $("#announceMentTyptChoice").removeClass(className);
                                    var announceTitle = $("#announcementTitle").val();
                                    $("#announcementTitle").val("");
                                    var announceBody = $("#announceBody").val();
                                    $("#announceBody").val("");
                                    if (announceTitle == "") {
                                        alert("Title Can't Be Null.")
                                    } else if (announceBody == "") {
                                        alert("Message Body Can't Be Null.");
                                    } else if (className == null) {
                                        alert("Announcement Type Must Be Choice.");
                                    } else {
                                        var currentTime = gettime();
                                        $.ajax({
                                            url: "/librarian/addAnnouncement",
                                            type: "post",
                                            dataType: "json",
                                            data: {
                                                "title": announceTitle,
                                                "body": announceBody,
                                                "messageType": className
                                            },
                                            success: function (data) {
                                                var jsonData = eval(data);
                                                $("#announceMentList").prepend("<tr class='" + jsonData.messageType + "'>" +
                                                    "                                <td>" +
                                                    "                                 " + jsonData.date +
                                                    "                                </td>" +
                                                    "                                <td>" +
                                                    "                                 " + jsonData.title +
                                                    "                                </td>" +
                                                    "                                <td>" +
                                                    "                                    " + jsonData.body +
                                                    "                                </td>" +
                                                    "                                 <td>" +
                                                    "                                     <a onclick='editTheAnnouncement(" + jsonData.id + ",this)'>edit</a>" +
                                                    "                                 </td> " +
                                                    "                               <td>" +
                                                    "                                     <a onclick='deleteTheAnnouncement(" + jsonData.id + ",this)'>delete this</a>  " +
                                                    "                             </td>" +
                                                    "                            </tr>");
                                                var announceObj = {
                                                    typeId: "1",//1表示是公告消息
                                                    senderName: announceTitle,
                                                    messageContent: announceBody,
                                                    announcementId: jsonData.id,
                                                    announcementType: className
                                                };
                                                var str = JSON.stringify(announceObj);
                                                ws.send(str);
                                                className = null;
                                            }
                                        });
                                    }
                                });

                                function jumpToAnnouncementCenter2(obj) {
                                    var id = $(obj).attr("id");
                                    jumpToAnnouncementCenter1(id);
                                };

                                function jumpToAnnouncementCenter1(id) {
                                    // document.getElementById("titleList").innerHTML = "";
                                    $.ajax({
                                        url: "/librarian/requestAnnouncementListInfo",
                                        type: "post",
                                        dataType: "text",
                                        success: function (data) {
                                            document.getElementById("titleList").innerHTML = "";
                                            var jsonData = eval("(" + data + ")");
                                            $(jsonData).each(function () {
                                                var appendClass;
                                                if (this.messageType == "") {
                                                    appendClass = " fontShowBlack ";
                                                } else {
                                                    appendClass = this.messageType + " fontShowWhite";
                                                }
                                                if (this.id == id) {
                                                    preId = id;
                                                    appendClass += " active ";
                                                }

                                                $("#titleList").append("<li id='announce" + this.id + "' class=\"nav-item " + appendClass + " \"" +
                                                    "                            style=\"border-radius: 7px;\">\n" +
                                                    "                            <a  class=\"nav-link\"" +
                                                    "                            onclick='changeTitleAndContentAndDateAndName(\"" + this.id + "\",\"" + this.title + "\",\"" + this.body + "\",\"" + this.date + "\"," +
                                                    "                                  \"" + this.name + "\")'>" +
                                                    "                            " + this.title +
                                                    "                            </a>\n" +
                                                    "                    </li>")

                                            });
                                        }
                                    });
                                    $.ajax({
                                        url: "/librarian/announcementTitleAndContent",
                                        type: "post",
                                        dataType: "json",
                                        data: {
                                            "id": id
                                        },
                                        success: function (data) {
                                            //  var jsonData = eval("(" + data + ")");
                                            var jsonData = eval(data);
                                            $("#currentTitle").text(jsonData.title);
                                            $("#currentSendTime").text(jsonData.date);
                                            $("#currentSenderName").text(jsonData.name);
                                            $("#currentContent").text(jsonData.body);
                                        },
                                        error: function (data) {
                                        }
                                    });
                                    $("#announcementli").click();
                                }

                                function changeTitleAndContentAndDateAndName(id, title, content, date, name) {
                                    $("#announce" + preId + "").removeClass("active");
                                    $("#announce" + id + "").addClass("active");
                                    preId = id;
                                    $("#currentTitle").text(title);
                                    $("#currentSendTime").text(date);
                                    $("#currentSenderName").text(name);
                                    $("#currentContent").text(content);
                                    //没有进行历史消息的缓存先暂时将消息body进行清空
                                    $("#announceMentBody")[0].innerHTML = "";
                                }

                                function gettime() {
                                    var date = new Date();
                                    var year = date.getFullYear();
                                    var month = date.getMonth() + 1;//js中是从0开始所以要加1
                                    var day = date.getDate();
                                    var hour = date.getHours();
                                    var minute = date.getMinutes();
                                    var second = date.getSeconds();
                                    var presentTime = year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ":" + second;
                                    return presentTime;
                                }


                            </script>
                        </div>
                        <div class="page-header">
                            <h1>
                                <small>All Announcement :</small>
                            </h1>
                        </div>
                        <table class="table  table-bordered" id="allAnnouncementTable">
                            <thead>
                            <tr>
                                <th>
                                    send Time
                                </th>
                                <th>
                                    Title
                                </th>
                                <th>
                                    Message Body
                                </th>
                                <th>
                                    Edit
                                </th>
                                <th>
                                    delete Annoumcement
                                </th>
                            </tr>
                            </thead>
                            <tbody id="announceMentList" th:each="temp:${announcementMessageList}">
                            <tr th:class="${temp.getMessageType()}">
                                <td th:text="${temp.getDate()}">

                                </td>
                                <td th:text="${temp.getTitle()}">

                                </td>
                                <td th:text="${temp.getBody()}">
                                </td>
                                <td>
                                    <a th:onclick="'javascript:editTheAnnouncement('+${temp.getId()}+','+this+')'">edit</a>
                                </td>
                                <td>
                                    <a th:onclick="'javascript:deleteTheAnnouncement('+${temp.getId()}+','+this+')'">
                                        delete this
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <a id="modal-EditAnnoumcemnet" style="display: none" href="#modal-container-EditAnnoumcemnet"
                           role="button" class="btn" data-toggle="modal"></a>

                        <div class="modal fade" id="modal-container-EditAnnoumcemnet" role="dialog"
                             aria-labelledby="myModalLabelEditAnnoumcemnet" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
                                        </button>
                                        <h4 class="modal-title" id="myModalLabelEditAnnoumcemnet">
                                            Edit Announcement :
                                        </h4>
                                    </div>
                                    <div class="modal-body">
                                        <form class="form-horizontal" id="editAnnouncementForm" role="form"
                                              method="post" action="librarian/editAnnouncementContent"
                                              th:action="@{librarian/editAnnouncementContent}"
                                              onkeydown="if(event.keyCode==13)return false;">
                                            <div class="form-group">
                                                <label for="editAnnouncementTItle"
                                                       class="col-sm-2 control-label">Title</label>
                                                <div class="col-sm-10">
                                                    <input type="hidden" name="announceMentId" id="editAnnouncementId"
                                                           value="">
                                                    <input type="text" class="form-control" name="title"
                                                           id="editAnnouncementTitle"/>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="editAnnouncementBody"
                                                       class="col-sm-2 control-label">Body</label>
                                                <div class="col-sm-10">
                                                    <textarea style="resize: none;" class="form-control"
                                                              id="editAnnouncementBody" name="body">

                                                    </textarea>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal"
                                                id="closeEditAnnouncementModal">Close
                                        </button>
                                        <button type="button" class="btn btn-primary" id="saveEditAnnouncementBtn"
                                                onclick="saveEditAnnouncementFun()">Save
                                        </button>
                                    </div>
                                </div>

                            </div>

                        </div>

                        <script th:inline="javascript">

                            function checkEditAnnouncementInput() {
                                var title = $("#editAnnouncementTitle").val();
                                var body = $("#editAnnouncementBody").val();
                                title = trim(title);
                                body = trim(body);
                                if (title == "" || body == "") {
                                    alert("Input Can't Be Null.");
                                    return false;
                                } else {
                                    return true;
                                }
                            }

                            var currentEditedAnnouncementItem;

                            function saveEditAnnouncementFun() {
                                if (checkEditAnnouncementInput() == true) {
                                    $("#closeEditAnnouncementModal").click();
                                    $("#editAnnouncementForm").ajaxSubmit({
                                        success: function (data) {
                                            if (data == "ok") {
                                                $(currentEditedAnnouncementItem.parentNode.parentNode)
                                                    .children("td").eq(1).text($("#editAnnouncementTitle").val());
                                                $(currentEditedAnnouncementItem.parentNode.parentNode)
                                                    .children("td").eq(2).text($("#editAnnouncementBody").val());
                                                iosOverlay({
                                                    text: "Success",
                                                    duration: 1000,
                                                    icon: "global/images/check.png"
                                                })
                                            } else if (data == "nopresent") {
                                                alert("This Announcement Does't Exist");
                                            }
                                        },
                                        error: function (data) {
                                            alert("Edit Fail");
                                        }
                                    })
                                }
                            }

                            function editTheAnnouncement(id, obj) {
                                $("#modal-EditAnnoumcemnet").click();
                                $("#editAnnouncementId").val(id);
                                $("#editAnnouncementTitle").val(trim($(obj.parentNode.parentNode).children("td").eq(1).text()));
                                $("#editAnnouncementBody").text(trim($(obj.parentNode.parentNode).children("td").eq(2).text()));
                                currentEditedAnnouncementItem = obj;
                            }

                            function deleteTheAnnouncement(announcementId, obj) {
                                $.ajax({
                                    url: "/librarian/deleteAnnouncement",
                                    type: "post",
                                    dataType: "text",
                                    data: {
                                        "announcemantId": announcementId
                                    },
                                    success: function (data) {
                                       // alert("Delete Successfully")
                                        iosOverlay({
                                            text:"Success",
                                            duration:1000,
                                            icon:"global/images/check.png"
                                        })
                                    }
                                });
                                var i = obj.parentNode.parentNode.rowIndex;
                                document.getElementById("allAnnouncementTable").deleteRow(i);
                            }
                        </script>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="addbook" sec:authorize="hasRole('ROLE_LIBRARIAN')">
            <ul class="nav nav-tabs">
                <li class="active">
                    <a href="#panel-AddBook" data-toggle="tab">Add Book</a>
                </li>
                <li>
                    <a href="#panel-DeleteBook" data-toggle="tab">Delete Book</a>
                </li>
                <li>
                    <a href="#panel-ManageBookCategory" data-toggle="tab">Manage Category</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="panel-AddBook">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#withoutISBN" data-toggle="tab">Without ISBN</a>
                        </li>
                        <li>
                            <a href="#withISBN" data-toggle="tab">With ISBN</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="withoutISBN">
                            <div class="container" style="margin-top: 20px">
                                <div class="row clearfix">
                                    <div class="page-header">
                                        <h1>
                                            <small>Book Information</small>
                                        </h1>
                                    </div>
                                    <div class="col-md-2 column">
                                        <label class="control-label">Choose Book Picture:</label>
                                        <hr>
                                        <div>
                                            <input style="display: none" type="file" id="chooseImage">
                                            <button id="addImageButton" class="form-control">Choose Picture</button>
                                            <img id="cropedBigImg"
                                                 alt="No Picture" style="width: 100px;height: 200px;"/>
                                            <div class="modal-footer" id="fileQueue"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-10 column">
                                        <form class="form-horizontal" role="form">
                                            <!--    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">-->
                                            <div class="form-group">
                                                <label for="bookName" class="col-sm-2 control-label">Book Name :</label>
                                                <div class="col-sm-3">
                                                    <input type="text" class="form-control" id="bookName"
                                                           name="bookName"/>
                                                </div>
                                                <label for="author" class="col-sm-2 control-label">author :</label>
                                                <div class="col-sm-3">
                                                    <input type="text" class="form-control" id="author" name="author"/>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="introduction" class="col-sm-2 control-label">Introduction
                                                    :</label>
                                                <div class="col-sm-10">
                                  <textarea style="resize: none" rows="4" clos="20" class="form-control"
                                            id="introduction" name="introduction"></textarea>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="bookNumber" class="col-sm-2 control-label">BookNumber
                                                    :</label>
                                                <div class="col-sm-2">
                                                    <input min="1" max="200" type="number" class="form-control"
                                                           id="bookNumber" name="bookNumber"/>
                                                </div>
                                                <label for="bookType" class="col-sm-offset-2 col-sm-2 control-label">Choose
                                                    BookType
                                                    :</label>
                                                <div class="col-sm-4">
                                                    <div class="btn-group">
                                                        <button id="bookType" class="btn btn-default" type="button">
                                                            BookType
                                                        </button>
                                                        <button data-toggle="dropdown"
                                                                class="btn btn-default dropdown-toggle">
                                                            <span class="caret"></span></button>
                                                        <ul class="dropdown-menu">
                                                            <li th:each="temp:${bookCategoryList}">
                                                                <a class="bookTypeClass"
                                                                   th:onclick="'javascript:choiceBookType('+${temp.getId()}+','+this+')'"
                                                                   th:text="${temp.getTypename()}"></a>
                                                            </li>
                                                        </ul>
                                                        <!--二级菜单列表-->
                                                        <!--<ul class="dropdown-menu">
                                                            <li class="dropdown-submenu">
                                                                <a href="#">foreign language</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${foreignlanguage}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">architecture</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${architecture}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">education</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${education}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">literature</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${literature}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">law</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${law}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">environment</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${environment}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">biology/chemistry</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${biologychemistry}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">management</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${management}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">art</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${art}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">computer</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${computer}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="dropdown-submenu">
                                                                <a href="#">mechanism</a>
                                                                <ul class="dropdown-menu">
                                                                    <tr th:each="temp:${mechanism}">
                                                                        <li class="row clearfix text-center">
                                                                            <a class="bookTypeClass" th:id="${temp.getId()}"
                                                                               th:text="${temp.getTypename_en()}">

                                                                            </a>
                                                                        </li>
                                                                    </tr>
                                                                </ul>
                                                            </li>
                                                            <li class="divider">
                                                            </li>
                                                            <li>
                                                                <a class="bookTypeClass" href="#" id="129">other</a>
                                                            </li>
                                                        </ul>-->
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="bookPublisher" class="col-sm-2 control-label">Publisher
                                                    : </label>
                                                <div class="col-sm-3">
                                                    <input type="text" class="form-control" id="bookPublisher"
                                                           name="bookPublisher">
                                                </div>
                                                <label for="bookPrice" class="col-sm-2 control-label">Price : </label>
                                                <div class="col-sm-3">
                                                    <input type="text" class="form-control" id="bookPrice"
                                                           name="bookPrice">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-offset-10">
                                                    <button type="button" id="librarianAddBook"
                                                            class="btn btn-default btn-primary btn-lg">
                                                        Add
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <script type="text/javascript">
                                //使用按钮覆盖代替input的事件
                                var input = document.getElementById("chooseImage");
                                var button = document.getElementById("addImageButton");
                                button.addEventListener("click", function (ev) {
                                    ev.preventDefault();
                                    input.click();
                                });

                                var pic = null, formdata, bookTypeId = -1;//图书的类型的id
                                $('#chooseImage').on('change', function () {
                                    var filePath = $(this).val(),
                                        fileFormat = filePath.substring(filePath.lastIndexOf(".")).toLowerCase(),
                                        src = window.URL.createObjectURL(this.files[0]);
                                    if (!fileFormat.match(/.png|.jpg|.jpeg/)) {
                                        alert('上传错误,文件格式必须为：png/jpg/jpeg');
                                        return;
                                    }
                                    pic = this.files[0];
                                    $('#cropedBigImg').attr('src', src);
                                });

                                $("#librarianAddBook").click(function () {
                                    var bookName = $("#bookName").val();
                                    var author = $("#author").val();
                                    var introduction = $("#introduction").val();
                                    var bookNumber = $("#bookNumber").val();
                                    var bookPublisher = $("#bookPublisher").val();
                                    var bookPrice = $("#bookPrice").val();
                                    if (pic == null) {
                                        alert("Please Choice A Book Picture.")
                                    } else if (trim(bookName) == "" || trim(author) == "" || trim(introduction) == "" || trim(bookPublisher) == "" || trim(bookPrice) == "") {
                                        alert("Please complete the book information");
                                    } else if (!isNumber(bookNumber)) {
                                        alert("Please Input a Correct Book Amount")
                                    } else if (parseInt(bookNumber) <= 0 || parseInt(bookNumber) >= 100) {
                                        alert("The number of books must be in the range of 0 to 100 ");
                                    } else if (bookTypeId == -1) {
                                        alert("BooType Must Choice");
                                    } else {
                                        formdata = new FormData();
                                        formdata.append("file", pic);
                                        formdata.append("bookName", bookName);
                                        formdata.append("author", author);
                                        formdata.append("introduction", introduction);
                                        formdata.append("bookNumber", bookNumber);
                                        formdata.append("bookTypeId", bookTypeId);
                                        formdata.append("bookPublisher", bookPublisher);
                                        formdata.append("bookPrice", bookPrice);
                                        $.ajax({
                                            type: "POST",
                                            /*   beforeSend: function (xhr) {
                                               xhr.setRequestHeader(header, token);
                                           },*/
                                            url: "/librarian/addBook",
                                            data: formdata,
                                            processData: false, //必须false才会自动加上正确的Content-Type
                                            dataType: 'text',
                                            contentType: false,
                                            success: function (data) {
                                                $("#showBarCodeHref").click();
                                                var jsonData = eval(data);
                                                document.getElementById("appendBarCode").innerHTML = "";
                                                for (var i = 0; i < jsonData.length; i++) {
                                                    $("#appendBarCode").append("<div class='form-group'><svg  id='barCode" + i + "'></svg></div>");
                                                }
                                                for (var j = 0; j < jsonData.length; j++) {
                                                    $("#barCode" + j + "").JsBarcode(jsonData[j]);
                                                }
                                                $('#cropedBigImg').attr('src', "");
                                                document.getElementById("bookType").innerText = 'bookType';
                                            }
                                        });
                                        bookTypeId = -1;
                                        pic = null;
                                        $("#bookName").val("");
                                        $("#author").val("");
                                        $("#introduction").val("");
                                        $("#bookNumber").val("");
                                        $("#bookPublisher").val("");
                                        $("#bookPrice").val("");
                                    }
                                });

                                function choiceBookType(id, obj) {
                                    var temp = $(obj).text();
                                    bookTypeId = id;
                                    $("#bookType").text(temp);
                                }

                            </script>
                        </div>
                        <div class="tab-pane" id="withISBN">
                            <div class="container">
                                <div class="form-group">
                                    <h3>
                                        <small>Book Information</small>
                                    </h3>
                                </div>
                                <div class="form-group">
                                    <input style="width: 300px;" id="searchWithISBNInput" class="col-md-2 form-control"
                                           type="number">
                                    <button type="button" class="btn btn-default" onclick="librarianSearchWithISBN()">
                                        Search
                                    </button>
                                </div>
                                <div class="page-header">
                                    <h1>
                                        <small>Book Information</small>
                                    </h1>
                                </div>
                                <div class="col-md-2">
                                    <label for="ISBNcropedBigImg">Picture</label>
                                    <hr>
                                    <img id="ISBNcropedBigImg"
                                         alt='No Picture' style='width: 100px;height: 200px;'>
                                </div>
                                <div class="col-md-10">
                                    <form action="/librarian/ISBNAddBook" id="IsbnForm"
                                          method="post" class="form-horizontal"
                                          onkeydown="if(event.keyCode==13)return false;">
                                        <div class="form-group">
                                            <input type="hidden" id="isbnPictureSrc" name="picture" value="">
                                            <label for="ISBNbookName" class="col-md-2 control-label">Book Name :</label>
                                            <div class="col-md-3">
                                                <input id="ISBNbookName" name="bookName" class="form-control">
                                            </div>
                                            <label for="ISBNauthor" class="control-label col-md-2">author :</label>
                                            <div class="col-md-3">
                                                <input id="ISBNauthor" name="author" class="form-control">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="ISBNintroduction" class="col-md-2 control-label">Introduction
                                                :</label>
                                            <div class="col-md-8">
                                        <textarea rows="4" id="ISBNintroduction" name="introduction"
                                                  class="form-control"
                                                  style='resize: none'>

                                        </textarea>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="isbnBookNumber" class="col-md-2 control-label">Book
                                                Number:</label>
                                            <div class="col-md-3">
                                                <input type="number" id="isbnBookNumber" name="bookNumber" min="1"
                                                       max="200"
                                                       class="form-control">
                                            </div>
                                            <label for="isbnBookType" class="col-md-2 control-label">Book Type :</label>
                                            <div class="btn-group col-md-3">
                                                <button id="isbnBookType" class="btn btn-default" type="button">bookType
                                                </button>
                                                <input id="isbnBookTypeId" type="hidden" name="bookTypeId">
                                                <button data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                                                    <span class="caret"></span></button>
                                                <ul class="dropdown-menu">
                                                    <li th:each="temp:${bookCategoryList}">
                                                        <a class="bookTypeClass"
                                                           th:onclick="'javascript:isbnChoiceBookType('+${temp.getId()}+','+this+')'"
                                                           th:text="${temp.getTypename()}"></a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="ISBNbookPublisher" class="control-label col-md-2">publisher
                                                :</label>
                                            <div class="col-md-3">
                                                <input class="col-md-3 form-control" type="text" id="ISBNbookPublisher"
                                                       name="bookPublisher">
                                            </div>
                                            <label for="ISBNbookPrice" class="control-label col-md-2">price :</label>
                                            <div class="col-md-3">
                                                <input id="ISBNbookPrice" class="col-md-3 form-control"
                                                       name="bookPrice">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <button onclick="ISBNAddBook()"
                                                    type="button" class="col-lg-offset-10 btn btn-primary btn-lg">Add
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <script type="text/javascript">

                                function isbnChoiceBookType(id, obj) {
                                    $("#isbnBookType").text($(obj).text());
                                    $("#isbnBookTypeId").val(id);
                                }

                                function librarianSearchWithISBN() {
                                    var isbn = $("#searchWithISBNInput").val();
                                    if (isbn == "") {
                                        alert("Input can't Be null");
                                    } else {
                                        $.ajax({
                                            url: "/librarian/searchBookWithIsbn",
                                            type: "post",
                                            data: {
                                                "ISBN": isbn
                                            },
                                            dataType: "text",
                                            success: function (data) {
                                                if (data == "fileNotFound") {
                                                    alert("This Book Is Not Present.");
                                                } else {
                                                    var jsonData = eval("(" + data + ")");
                                                    $("#isbnPictureSrc").val(jsonData.bookPicNumber);
                                                    $("#ISBNcropedBigImg").attr("src", "/bookpicture/" + jsonData.bookPicNumber);
                                                    $("#ISBNbookName").attr("value", jsonData.name);
                                                    $("#ISBNauthor").attr("value", jsonData.author);
                                                    $("#ISBNintroduction").text(jsonData.introduction);
                                                    $("#ISBNbookPublisher").val(jsonData.publisher);
                                                    $("#ISBNbookPrice").val(jsonData.price);
                                                }
                                            }
                                        })
                                    }
                                }


                                function checkWithISBNBookInformation() {
                                    var bookName = $("#ISBNbookName").val();
                                    var author = $("#ISBNauthor").val();
                                    var introduction = $("#ISBNintroduction").val();
                                    var bookNumber = $("#isbnBookNumber").val();
                                    var bookType = $("#isbnBookType").text();
                                    var publisher = $("#ISBNbookPublisher").val();
                                    var price = $("#ISBNbookPrice").val();
                                    if (trim(bookName) == "" || trim(author) == "" || trim(introduction) == ""
                                        || trim(publisher) == "" || trim(price) == "") {
                                        alert("Please complete the book information");
                                        return false;
                                    } else if (!isNumber(bookNumber)) {
                                        alert("Please Input a Correct Book Amount");
                                        return false;
                                    } else if (parseInt(bookNumber) < 0 || parseInt(bookNumber) > 100) {
                                        alert("Please Input a Correct Book Amount");
                                        return false;
                                    } else if (bookType == "bookType") {
                                        alert("Please Choice Book Type");
                                        return false;
                                    }
                                    return true;
                                }

                                function ISBNAddBook() {
                                    if (checkWithISBNBookInformation()) {
                                        $("#IsbnForm").ajaxSubmit({
                                            success: function (data) {
                                               /* alert("Add Book Succcessfully.");*/
                                                var jsonData = eval(data);
                                                var i = 0;
                                                document.getElementById("appendBarCode").innerHTML = "";
                                                $(jsonData).each(function () {
                                                    $("#showBarCodeHref").click();
                                                    $("#appendBarCode").append("<div class='form-group'>" +
                                                        "                       <svg id='barCode" + i + "'>" +
                                                        "                       </svg>" +
                                                        "                       </div>");
                                                    $("#barCode" + i + "").JsBarcode(this);
                                                    i = parseInt(i) + 1;
                                                });

                                            },
                                            error: function (data) {
                                                alert("Appear An Error When Save Book");
                                            }
                                        });
                                        $("#isbnBookType").text("bookType");
                                        $("#IsbnForm").resetForm();
                                        $("#ISBNbookName").attr("value", "");
                                        $("#ISBNauthor").attr("value", "");
                                        $("#ISBNintroduction").text("");
                                        $("#ISBNcropedBigImg").attr("src", "");
                                        $("#searchWithISBNInput").val("");
                                    }
                                }
                            </script>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="panel-DeleteBook">
                    <ul class="nav nav-tabs">
                        <li class="active">
                            <a href="#panel-DeleteBookById" data-toggle="tab">Delete</a>
                        </li>
                        <li>
                            <a href="#panel-DeleteRecord" data-toggle="tab">Delete Record</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="panel-DeleteBookById">
                            <div class="container">
                                <div class="clearfix row">
                                    <div class="col-md-12">
                                        <form class="navbar-form navbar-right" role="search"
                                              target="iframe_display">
                                            <h3 class="control-label">
                                                <small>
                                                    Input Book Id ;
                                                </small>
                                            </h3>
                                            <div class="form-group">
                                                <input type="number" class="form-control" id="searchThedeleteBookInput"
                                                       name="searchName"/>
                                            </div>
                                            <button type="submit" id="searchThedeleteBookBtn" class="btn btn-default"
                                                    onclick="deleteTheDamagedBook()">Search
                                            </button>
                                            <script type="text/javascript">
                                                function deleteTheDamagedBook() {
                                                    var bookInput = $("#searchThedeleteBookInput").val();
                                                    if (bookInput == "" || bookInput == null) {
                                                        alert("ut Can't Be Null");
                                                    } else {
                                                        $.ajax({
                                                            url: "/librarian/deleteTheOneBook",
                                                            type: "post",
                                                            dataType: "text",
                                                            data: {
                                                                "keyWord": bookInput
                                                            },
                                                            success: function (data) {
                                                                document.getElementById("showDeleteBookBarCodeSvg").innerHTML = "";
                                                                document.getElementById("deleteBookFindBookResult").innerHTML = "";
                                                                if (data == "error") {
                                                                    alert("Check Your Input Search Key word.")
                                                                } else {
                                                                    //alert("Delete Successfully")
                                                                    var jsonData = eval("(" + data + ")");
                                                                    $("#showDeleteBookBarCodeSvg").JsBarcode(jsonData.oneBookId);
                                                                    $("#deleteBookFindBookResult").append("<div class='container' style='margin-top: 20px'>" +
                                                                        "            <div class='row clearfix'>" +
                                                                        "                <div class='col-md-2 column'>" +
                                                                        "                    <label class='control-label '>Picture</label>" +
                                                                        "                    <hr>" +
                                                                        "                    <div>" +
                                                                        "                        <img " +
                                                                        "                             alt='No Picture' style='width: 100px;height: 200px;' src='/bookpicture/" + jsonData.bookImag + "'/>" +
                                                                        "                    </div>" +
                                                                        "                </div>" +
                                                                        "                <div class='col-md-10 column'>" +
                                                                        "                    <form class='form-horizontal' method=\"post\" target=\"iframe_display\" onkeydown=\"if(event.keyCode==13)return false;\">" +
                                                                        "                        <div class='form-group'>" +
                                                                        "                            <input style='display: none;' name='oneBookId' value='" + jsonData.oneBookId + "' readonly='readonly'>" +
                                                                        "                            <label for='bookName' class='col-sm-2 control-label'>Book Name </label>" +
                                                                        "                            <div class=\"col-sm-3\">" +
                                                                        "                                <input name='bookName' class='form-control' value='" + jsonData.bookName + "' readonly='readonly'>" +
                                                                        "                            </div>" +
                                                                        "                            <label for='author' class='col-sm-2 control-label'>author </label>" +
                                                                        "                            <div class=\"col-sm-3\">" +
                                                                        "                                <input name='author' class='form-control' value='" + jsonData.author + "' readonly='readonly'>" +
                                                                        "                            </div>" +
                                                                        "                        </div>" +
                                                                        "                        <div class='form-group'>" +
                                                                        "                            <label for='introduction' class='col-sm-2 control-label'>Introduction </label>" +
                                                                        "                            <div class=\"col-sm-10\">\n" +
                                                                        "                            <textarea name='introduction'  rows=\"4\" clos='20' class='form-control' style='resize: none' readonly='readonly'>" + jsonData.introduction + "</textarea>" +
                                                                        "                            </div>" +
                                                                        "                        </div>" +
                                                                        "                        <div class=\"form-group\">" +
                                                                        "                            <label  class=\"col-sm-2 control-label\">surPlusBook </label>\n" +
                                                                        "                            <div class=\"col-sm-3\">" +
                                                                        "                                <input  class=\"form-control\" readonly='readonly' value='" + jsonData.surplus + "'>" +
                                                                        "                            </div>" +
                                                                        "                            <label class='col-sm-2 control-label'>Book Location</label>" +
                                                                        "                            <div class='col-sm-3'> " +
                                                                        "                               <input name='bookLocation' class='form-control' readonly='readonly' value='" + jsonData.bookLocation + "'>" +
                                                                        "                           </div> " +
                                                                        "                       </div>" +
                                                                        "                         <div class='form-group'>" +
                                                                        "                           <input type='button' readonly='readonly' class='btn btn-default  btn-danger col-sm-offset-10'" +
                                                                        "                              onclick='librarianDeleteTheBook(" + jsonData.oneBookId + ",\"" + jsonData.bookState + "\")'  value='Delete'>" +
                                                                        "                         </div>" +
                                                                        "                       </form>" +
                                                                        "                </div>" +
                                                                        "            </div>" +
                                                                        "        </div>");
                                                                }
                                                            }
                                                        })
                                                    }
                                                }

                                                function librarianDeleteTheBook(id, bookState) {
                                                    var ifdelete = confirm("Delete ?!!!");
                                                    if (ifdelete == true) {
                                                        $.ajax({
                                                            url: "/librarian/deleteBookById",
                                                            type: "post",
                                                            dataType: "text",
                                                            data: {
                                                                "id": id,
                                                            },
                                                            success: function (data) {
                                                                if (data == "error") {
                                                                    alert("delete Error.");
                                                                } else {
                                                                    document.getElementById("showDeleteBookBarCodeSvg").innerHTML = "";
                                                                    document.getElementById("deleteBookFindBookResult").innerHTML = "";
                                                                    iosOverlay({
                                                                        text:"Success",
                                                                        duration:1000,
                                                                        icon:"global/images/check.png"
                                                                    })
                                                                }
                                                            }
                                                        })
                                                    } else {

                                                    }
                                                }
                                            </script>
                                        </form>
                                    </div>
                                </div>
                                <div class="page-header displayHorizontal">
                                    <h1>
                                        <small> Book Information :</small>
                                    </h1>
                                    <svg id="showDeleteBookBarCodeSvg"></svg>
                                </div>
                                <div id="deleteBookFindBookResult">

                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="panel-DeleteRecord">
                            <div class="container">
                                <div class="row clearfix">
                                    <div class="col-md-12 column">
                                        <form class="navbar-form navbar-right" role="search">
                                            <h3 class="control-label">
                                                <small>
                                                    Input Book Id Or Book Name;
                                                </small>
                                            </h3>
                                            <div class="form-group">
                                                <input type="text" class="form-control" id="searchDeletedBookInput"
                                                       name="searchName"/>
                                            </div>
                                            <button type="button" id="searchDeletedBookBtn" class="btn btn-default"
                                                    onclick="LibrariansearchDeletedBook()">Search
                                            </button>
                                        </form>
                                        <script type="text/javascript">
                                            function LibrariansearchDeletedBook() {
                                                var bookId = $("#searchDeletedBookInput").val();
                                                if (bookId == "") {
                                                    alert("Input Can't Be Null");
                                                }
                                                $.ajax({
                                                    url: "/librarian/searchDeleteBookInformation",
                                                    type: "post",
                                                    dataType: "text",
                                                    data: {
                                                        "bookId": bookId
                                                    },
                                                    success: function (data) {
                                                        if (data == "nobook") {
                                                            alert("This Book Is Not Present");
                                                            document.getElementById("deleteBookRecordList").innerHTML = "";
                                                        } else {
                                                            var jsonData = eval('(' + data + ')');
                                                            document.getElementById("deleteBookRecordList").innerHTML = "";
                                                            $(jsonData).each(function () {
                                                                $("#deleteBookRecordList").append(" <tr>" +
                                                                    "                                <td>" + this.bookId +
                                                                    "                                </td>" +
                                                                    "                                <td>" + this.bookName +
                                                                    "                                </td>" +
                                                                    "                                <td >" + this.librarianName +
                                                                    "                                </td>" +
                                                                    "                                <td>" + this.deleteTime +
                                                                    "                                </td>" +
                                                                    "                            </tr>");
                                                            });
                                                        }
                                                    }
                                                })
                                            }
                                        </script>
                                        <div class="page-header">
                                            <h1>
                                                <small>Delete Book Record :</small>
                                            </h1>
                                        </div>
                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th>
                                                    BookId
                                                </th>
                                                <th>
                                                    BookName
                                                </th>
                                                <th>
                                                    Librarian Name
                                                </th>
                                                <th>
                                                    Delete Time
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody id="deleteBookRecordList">
                                            <tr th:each="temp:${deleteBookRecord}">
                                                <td th:text="${temp.getBookId()}">
                                                </td>
                                                <td th:text="${temp.getBookName()}">
                                                </td>
                                                <td th:text="${temp.getLibrarianName()}">
                                                </td>
                                                <td th:text="${temp.getDeleteTime()}">
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="panel-ManageBookCategory">
                    <div class="container">
                        <div class="row clearfix">
                            <div class="col-md-12 column">
                                <div class="form-group" style="margin-top: 30px">
                                    <button type="button" class="btn btn-default btn-info col-lg-offset-10"
                                            id="addBookCategory" href="#modal-container-715784" data-toggle="modal">Add
                                        Category
                                    </button>
                                    <!--<a id="modal-715784" href="#modal-container-715784" role="button" class="btn" data-toggle="modal">触发遮罩窗体</a>
        -->
                                    <div class="modal fade" id="modal-container-715784" role="dialog"
                                         aria-labelledby="myModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal"
                                                            aria-hidden="true">
                                                        ×
                                                    </button>
                                                    <h4 class="modal-title" id="addCategoryModalLabel">
                                                        Input Category Name You Want To Add :
                                                    </h4>
                                                </div>
                                                <div class="modal-body">
                                                    <form class="form-horizontal"
                                                          onkeydown="if(event.keyCode==13)return false;">
                                                        <div class="form-group">
                                                            <label for="categoryName" class="col-sm-2 control-label">Category
                                                                Name </label>
                                                            <div class="col-sm-10">
                                                                <input type="text" class="form-control"
                                                                       id="categoryName"/>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="bookShelfNumber" class="col-sm-2 control-label">BookShelf
                                                                Amount</label>
                                                            <div class="col-sm-4">
                                                                <input class="form-control" type="number"
                                                                       id="bookShelfNumber"
                                                                       max="10" min="1"
                                                                       value="5">
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal"
                                                            id="categoryModalCloseBtn">Close
                                                    </button>
                                                    <button type="button" class="btn btn-primary"
                                                            onclick="addCategryBtn()">
                                                        Add
                                                    </button>
                                                    <!--增加图书的种类-->
                                                    <script type="text/javascript">
                                                        function addCategryBtn() {
                                                            var categoryName = $("#categoryName").val();
                                                            if (categoryName == "" || categoryName == null) {
                                                                alert("CategoryName Can't Be Null.")
                                                            } else {
                                                                $("#categoryName").val("");
                                                                var bookShelves = $("#bookShelfNumber").val();
                                                                $("#bookShelfNumber").val("5");
                                                                $("#categoryModalCloseBtn").click();
                                                                var categoryId;
                                                                $.ajax({
                                                                    url: "/librarian/addBookCategory",
                                                                    type: "post",
                                                                    dataType: "text",
                                                                    async: false,
                                                                    data: {
                                                                        "categoryName": categoryName,
                                                                        "bookShelfNumber": bookShelves
                                                                    },
                                                                    success: function (data) {
                                                                        iosOverlay({
                                                                            text:"Success",
                                                                            duration:1000,
                                                                            icon:"global/images/check.png"
                                                                        })

                                                                        categoryId = data;
                                                                    }
                                                                });
                                                                $("#bookCategoryTable").prepend("<tr>" +
                                                                    "<td>" + categoryId +
                                                                    "</td>" +
                                                                    "<td>" + categoryName +
                                                                    "</td>" +
                                                                    "<td>" +
                                                                    "<a onclick='editThisBookCategory(" + categoryId + ", this )'>edit</a>" +
                                                                    "</td>" +
                                                                    "<td>" +
                                                                    "   <a onclick='deleteThisBookCategory(" + categoryId + ", this )'>delete</a>" +
                                                                    "</td>" +
                                                                    "<td>" +
                                                                    "<a onclick='manageCategoryCapacity(" + categoryId + ")'>manage capacity</a>" +
                                                                    "</td>" +
                                                                    "</tr>");
                                                            }
                                                        }
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <form id="searchCategoryForm" class="navbar-form navbar-right" role="search"
                                          action="/librarian/searchBookCategory"
                                          th:action="@{/librarian/searchBookCategory}" method="post"
                                          onkeydown="if(event.keyCode==13)return false;">
                                        <h3>
                                            <small>Input Category Name</small>
                                        </h3>
                                        <div class="form-group">
                                            <input type="text" id="categoryNameInput" class="form-control"
                                                   name="categoryName"/>
                                            <button type="button" onclick="searchBookCategory()"
                                                    class="btn btn-default">
                                                Search
                                            </button>
                                        </div>
                                    </form>
                                    <script type="text/javascript">
                                        function searchBookCategory() {
                                            var categoryName = $("#categoryNameInput").val();
                                            if (categoryName == "" || categoryName == null) {
                                                alert("Input Can't Be Null");
                                            } else {
                                                $("#searchCategoryForm").ajaxSubmit({
                                                    success: function (data) {
                                                        if (data == "error") {
                                                            alert("This Book Type Is Not Present")
                                                            document.getElementById("bookCategoryTable").innerHTML = "";
                                                        } else {
                                                            var jsonData = eval('(' + data + ')');
                                                            document.getElementById("bookCategoryTable").innerHTML = "";
                                                            $(jsonData).each(function () {
                                                                $("#bookCategoryTable").append("<tr>" +
                                                                    "<td>" + this.id +
                                                                    "</td>" +
                                                                    "<td>" + this.typename +
                                                                    "</td>" +
                                                                    "<td>" +
                                                                    "<a onclick='editThisBookCategory(" + this.id + ",this)'>edit</a>" +
                                                                    "</td>" +
                                                                    "<td>" +
                                                                    "<a onclick='deleteThisBookCategory(" + this.id + ",this)'>delete</a>" +
                                                                    "</td>" +
                                                                    "<td>" +
                                                                    "<a onclick='manageCategoryCapacity(" + this.id + ")'>manage capacity</a>" +
                                                                    "</td>" +
                                                                    "</tr>"
                                                                )
                                                            });
                                                        }
                                                    },
                                                    error: function (data) {
                                                        alert("Search Category Appear An Error.");
                                                    }
                                                })
                                            }
                                        }
                                    </script>
                                </div>
                                <div class="page-header">
                                    <h1>
                                        <small>Current Book Category :</small>
                                    </h1>
                                </div>
                                <table class="table table-hover table-bordered" id="categoryListTable">
                                    <thead>
                                    <tr>
                                        <th>
                                            id
                                        </th>
                                        <th>
                                            name
                                        </th>
                                        <th>
                                            edit
                                        </th>
                                        <th>
                                            delete
                                        </th>
                                        <th>
                                            capacity
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody id="bookCategoryTable">
                                    <tr th:each="temp:${bookCategoryList}">
                                        <td th:text="${temp.getId()}">

                                        </td>
                                        <td th:id="${temp.getId()}" th:text="${temp.getTypename()}">

                                        </td>
                                        <td>
                                            <a th:onclick="'javascript:editThisBookCategory('+${temp.getId()}+','+this+')'">edit</a>
                                        </td>
                                        <td>
                                            <a th:onclick="'javascript:deleteThisBookCategory('+${temp.getId()}+','+this+')'">delete</a>
                                        </td>
                                        <td>
                                            <a href="javascript:void(0)"
                                               th:onclick="'javascript:manageCategoryCapacity('+${temp.getId()}+')'">manage
                                                capacity</a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <a id="modal-categoryCapacity" style="display: none"
                                   href="#modal-container-categoryCapacity" role="button" class="btn"
                                   data-toggle="modal"></a>

                                <div class="modal fade" id="modal-container-categoryCapacity" role="dialog"
                                     aria-labelledby="manageBookCategoryCapacity" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"
                                                        aria-hidden="true">×
                                                </button>
                                                <h4 class="modal-title" id="manageBookCategoryCapacity">
                                                    Edit This Type Capacity
                                                </h4>
                                            </div>
                                            <div class="modal-body">
                                                <form class="form-horizontal" role="form"
                                                      onkeydown="if(event.keyCode==13)return false;">
                                                    <div class="form-group">
                                                        <label class="col-sm-5 control-label">Shelf Amount</label>
                                                        <div class="col-sm-5">
                                                            <input type="hidden" id="currentChangedBookTypeId" value="">
                                                            <input type="number" min="1" class="form-control"
                                                                   id="thisBookTypeBookShelfAmount" value=""/>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default"
                                                        id="closeBookShelfAmountClose" data-dismiss="modal">Close
                                                </button>
                                                <button type="button" class="btn btn-primary"
                                                        id="changeBookTypeShelfAmount"
                                                        onclick="changeBookTypeShelfAmount()">Save
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <script th:inline="javascript">

                                    function changeBookTypeShelfAmount() {
                                        var amount = $("#thisBookTypeBookShelfAmount").val();
                                        if (parseInt(amount) <= 0) {
                                            alert("This Book Type Shelf Amount can't Be Null.");
                                        } else {
                                            $.ajax({
                                                url: "/librarian/changeBookTypeShelfAmount",
                                                type: "post",
                                                dataType: "text",
                                                data: {
                                                    "bookTypeId": $("#currentChangedBookTypeId").val(),
                                                    "amount": amount
                                                },
                                                success: function (data) {
                                                    if (data == "ok") {
                                                        iosOverlay({
                                                            text:"Success",
                                                            duration:1000,
                                                            icon:"global/images/check.png"
                                                        })

                                                        //  alert("Change This Category Capacity Successfully.");
                                                    } else {
                                                        alert("Librarian Lack Of Space.");
                                                    }
                                                },
                                                error: function (data) {
                                                    alert("Librarian Lack Of Space.");
                                                }
                                            });
                                        }
                                        $("#closeBookShelfAmountClose").click();
                                    }

                                    function manageCategoryCapacity(id) {
                                        $.ajax({
                                            url: "/librarian/getTypeCategory",
                                            dataType: "text",
                                            type: "post",
                                            data: {
                                                "id": id
                                            },
                                            success: function (data) {
                                                if (data == "error") {
                                                    alert("Manage Capacity Error");
                                                } else {
                                                    $("#currentChangedBookTypeId").val(id);
                                                    $("#thisBookTypeBookShelfAmount").val(data);
                                                    $("#modal-categoryCapacity").click();
                                                }
                                            }
                                        });

                                    }

                                    function deleteThisBookCategory(id, obj) {
                                        $.ajax({
                                            url: "/librarian/deleteTheBookCategory",
                                            type: "post",
                                            dataType: "text",
                                            data: {
                                                "id": id
                                            },
                                            success: function (data) {
                                                iosOverlay({
                                                    text:"Success",
                                                    duration:1000,
                                                    icon:"global/images/check.png"
                                                })

                                                //alert("Delete Successful")
                                            }
                                        });
                                        var i = obj.parentNode.parentNode.rowIndex;
                                        document.getElementById("categoryListTable").deleteRow(i);
                                    }

                                    function editThisBookCategory(id, obj) {
                                        var newName = prompt("Input the New Category Name");
                                        var i = obj.parentNode.parentNode.rowIndex;
                                        if (newName == null || newName == "") {
                                            alert("New Category Can't Be Null.");
                                        } else {
                                            document.getElementById("categoryListTable").rows[i].cells[1].innerText = newName;
                                            $("#" + id + "").text(newName);
                                            $.ajax({
                                                url: "/librarian/saveCategoryEditBook",
                                                type: "post",
                                                dataType: "text",
                                                data: {
                                                    "id": id,
                                                    "newName": newName
                                                },
                                                success: function (data) {
                                                    iosOverlay({
                                                        text:"Success",
                                                        duration:1000,
                                                        icon:"global/images/check.png"
                                                    })

                                                    // alert("Save Edit Successfully");
                                                }
                                            })
                                        }
                                    }

                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="tab-pane" id="returnBook" sec:authorize="hasRole('ROLE_LIBRARIAN')">
            <div class="container">
                <div class="row clearfix">
                    <div class="col-sm-12 column">
                        <form class="form-horizontal" role="form" onkeydown="if(event.keyCode==13)return false;">
                            <div class="form-group" style="margin-top: 50px;">
                                <button type="button" class="btn btn-default btn-info col-lg-offset-10"
                                        id="addReturnBook">Add one
                                </button>
                                <button type="button" class="btn btn-default " id="returnBookBtn"
                                        onclick="returnBookFun()">Return Book
                                </button>
                            </div>
                            <div id="returnBookItem">
                                <div class="form-group retuBookItemClass">
                                    <label class="col-sm-2 control-label ">bookId</label>
                                    <div class="col-sm-3">
                                        <input type="number" class="form-control">
                                    </div>
                                    <label class="col-sm-2 control-label ">comment</label>
                                    <div class="col-sm-3">
                                        <input type="text" class="form-control ">
                                    </div>
                                    <button type='button' class='returnBookDeleteIco' style='margin-left: 5px;'
                                            onclick='deleteThisItem(this)'>×
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <script type="text/javascript">
                function returnBookFun() {
                    $(".retuBookItemClass").each(function () {
                        var returnBookId = $(this).children('div').eq(0).children('input').eq(0).val();
                        var returnBookComment = $(this).children('div').eq(1).children('input').eq(0).val();
                        if (returnBookId == "") {
                            alert("Book Id Can't Input Null");
                        } else {
                            $.ajax({
                                url: "/librarian/returnBook",
                                type: "post",
                                dataType: "text",
                                async: false,
                                data: {
                                    "bookId": returnBookId,
                                    "comment": returnBookComment
                                },
                                success: function (data) {
                                    if (data == "Please Pay Fine First") {
                                        alert("Please Pay This Book " + returnBookId + " Fine First")
                                    } else if (data == "This Book is Not Present") {
                                        alert("This Book " + returnBookId + " is Not Present");
                                    } else if (data == "This Book Is Not Lend") {
                                        alert("This Book " + returnBookId + " Is Not Lend");
                                    } else if (data == "error") {
                                        alert("Return Book Fail");
                                    } else if (data == "ok") {
                                        iosOverlay({
                                            text: "Success",
                                            duration: 1000,
                                            icon: "global/images/check.png"
                                        })
                                        //alert("Return Book Ok");
                                    }
                                }
                            })
                        }
                    });


                    document.getElementById("returnBookItem").innerHTML = "<div class=\"form-group retuBookItemClass\">\n" +
                        " <label\n" +
                        " class=\"col-sm-2 control-label \">bookId</label>\n" +
                        "<div class=\"col-sm-3\">\n" +
                        " <input type=\"number\" class=\"form-control \">\n" +
                        "</div>" +
                        " <label class=\"col-sm-2 control-label \">comment</label>\n" +
                        " <div class=\"col-sm-3\">\n" +
                        "<input type=\"text\" class=\"form-control \">\n" +
                        "</div>\n" +
                        "<button type =\"button\" class='returnBookDeleteIco' style='margin-left: 5px;'" +
                        " onclick='deleteThisItem(this)'>×</button>" +
                        "</div>";
                }
            </script>
        </div>
        <div class="tab-pane" id="showBarCodeDiv" sec:authorize="hasRole('ROLE_LIBRARIAN')">
            <div class="container">
                <div class="page-header">
                    <h1>
                        <small>Book BarCode</small>
                    </h1>
                </div>
                <div class="col-md-4 column">

                </div>
                <div id="appendBarCode" class="col-md-4 displayVertival">

                </div>
                <div class="col-md-4 column">

                </div>
                <script type="text/javascript">
                    /*当用户点击搜索结果的单个图书的i时候显示单个图书的信息*/
                    function jumpToShowOneBarCode(id) {
                        $("#showBarCodeHref").click();

                        /*$("#apppendBarCode").html("");*/
                        document.getElementById("appendBarCode").innerHTML = "";
                        $("#appendBarCode").append("<div class='form-group'>" +
                            "                       <svg id='showOneBarCode'>" +
                            "                     </svg>" +
                            "                       </div>");
                        $("#showOneBarCode").JsBarcode(id);
                    }
                </script>
            </div>
        </div>
        <div class="tab-pane" id="dealThedealTheReserveBookDiv" sec:authorize="hasRole('ROLE_LIBRARIAN')">
            <div class="container">
                <div class="row clearfix">
                    <div class="col-md-12 column">
                        <form class="navbar-form navbar-right" role="search"
                              action="/librarian/findUserReserveInformation" method="post" target="iframe_display"
                              onkeydown="if(event.keyCode==13)return false;">
                            <h3 class="control-label">
                                <small>
                                    search reserve information :
                                </small>
                            </h3>
                            <div class="form-group">
                                <input type="text" class="form-control" id="searchReserveInfo" name="searchName"/>
                            </div>
                            <button type="button" id="searchUserReserveInformation" class="btn btn-default">Search
                            </button>
                        </form>

                        <div class="container">
                            <div class="row clearfix">
                                <div class="col-md-12 column">
                                    <div class="page-header">
                                        <h1>
                                            <small>Valid Reserve :</small>
                                        </h1>
                                    </div>
                                    <table class="table table-hover table-bordered">
                                        <thead>
                                        <tr>
                                            <th>
                                                trade id
                                            </th>
                                            <th>
                                                book id
                                            </th>
                                            <th>
                                                reserve time
                                            </th>
                                            <th>
                                                Ignore
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody id="validFormBody">

                                        </tbody>
                                    </table>
                                    <div class="page-header">
                                        <h1>
                                            <small>Invalid Reserve :</small>
                                        </h1>
                                    </div>
                                    <table class="table table-hover table-bordered">
                                        <thead>
                                        <tr>
                                            <th>
                                                trade id
                                            </th>
                                            <th>
                                                book id
                                            </th>
                                            <th>
                                                reserve time
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody id="inValidFormBody">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script type="text/javascript">
                $("#searchUserReserveInformation").click(function () {
                    var name = $("#searchReserveInfo").val();
                    $.ajax({
                        url: "/librarian/findUserReserveInformation",
                        type: "post",
                        data: {
                            "searchName": name
                        },
                        dataType: "text",
                        success: function (data) {
                            if (data == "noreserve") {
                                alert("This reader does not have reserved book");
                                document.getElementById("validFormBody").innerHTML = "";
                                document.getElementById("inValidFormBody").innerHTML = "";
                            } else {
                                document.getElementById("validFormBody").innerHTML = "";
                                document.getElementById("inValidFormBody").innerHTML = "";
                                var jsondata = eval(data);
                                $(jsondata).each(function () {
                                    if (this.isVaild == "true") {
                                        $("#validFormBody").append(" <tr >" +
                                            "                                 <td>" +
                                            "                                   " + this.id +
                                            "                                 </td>" +
                                            "                                            <td>" +
                                            "                                              " + this.bookId +
                                            "                                            </td>" +
                                            "                                            <td>" +
                                            "                                               " + this.reservTime +
                                            "                                            </td>" +
                                            "                                            <td>" +
                                            "                                            <a   onclick='ignore(" + this.bookId + ")' >" +
                                            "                                             ignore" +
                                            "                                            </a>" +
                                            "                                            </td>" +
                                            "                                        </tr>")
                                    } else {
                                        $("#inValidFormBody").append(" <tr id='" + this.id + "' class='warning'>" +
                                            "                                            <td>" +
                                            "                                              " + this.id +
                                            "                                            </td>" +
                                            "                                            <td>" +
                                            "                                              " + this.bookId +
                                            "                                            </td>" +
                                            "                                            <td>" +
                                            "                                               " + this.reservTime +
                                            "                                            </td>" +
                                            "                                        </tr>")
                                    }
                                })
                            }
                        }
                    });

                });

                function ignore(id) {
                    $.ajax({
                        url: "/librarian/reserveBookNo",
                        type: "post",
                        data: {
                            "bookId": id
                        },
                        dataType: "text",
                        success: function (data) {
                            alert("ignore book " + data + " ok,you can flush to see change.");
                        }
                    })
                }
            </script>
        </div>
        <div class="tab-pane" id="announcementliDiv" sec:authorize="hasRole('ROLE_LIBRARIAN')">
            <div class="container" id="announcementContainer">
                <div class="col-md-3 column" style="height: 580px;">
                    <div class="page-header">
                        <h1>
                            <small>Announcement List :</small>
                        </h1>
                    </div>
                    <ul id="titleList" class="nav nav-pills nav-stacked barShowNone"
                        style="border-radius: 7px;height: 520px;overflow-y: auto">
                    </ul>
                </div>
                <div class="col-md-7 column" style="height: 580px">
                    <div class="page-header">
                        <h1>
                            <small id="currentTitle">Title For Header :</small>
                        </h1>
                    </div>
                    <div id="announceMentBody"
                         style="border: 1px solid #c4e3f3;width: 100%;height: 75%;border-radius:7px;overflow-y: auto;">

                    </div>
                    <div style="height: 35%;width: 100%;">
                        <textarea id="inputannouncementCommentTextArea" class="form-control" style="height: 35%;width: 100%;border: 1px solid #000000;
                         border-radius: 7px;resize: none;margin-top: 10px;"
                                  placeholder="Press shift and enter to send"></textarea>
                    </div>
                </div>
                <div class="col-md-2 column">
                    <div class="page-header">
                        <h1>
                            <small> Content :</small>
                        </h1>
                    </div>
                    <blockquote>
                        <p id="currentContent"></p>
                        <small id="currentSenderName"><cite></cite></small>
                        <small class="pull-right" id="currentSendTime" style="font-size: 5px"><cite></cite></small>
                    </blockquote>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="readerPayForFineDiv" sec:authorize="hasRole('ROLE_LIBRARIAN')">
            <div class="container">
                <div class="row clearfix">
                    <div class="col-md-12 column">
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a href="#payFinePanel" data-toggle="tab">Pay Fine</a>
                            </li>
                            <li>
                                <a href="#historyPanel" data-toggle="tab">Fine History</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="payFinePanel">
                                <div class="container">
                                    <div class="clearfix row">
                                        <div class="col-md-12">
                                            <form class="navbar-form navbar-right" role="search"
                                                  target="iframe_display"
                                                  onkeydown="if(event.keyCode==13)return false;">
                                                <h3 class="control-label">
                                                    <small>
                                                        search fine information :
                                                    </small>
                                                </h3>
                                                <div class="form-group">
                                                    <input type="text" class="form-control" id="searchUserFineValue"
                                                           name="searchName"/>
                                                </div>
                                                <button type="submit" id="searchUserFineValueBtn"
                                                        class="btn btn-default">Search
                                                </button>
                                            </form>
                                            <br>
                                            <div class="container">
                                                <div class="row clearfix">
                                                    <div class="page-header">
                                                        <h1>
                                                            <small>Overdue book list :<strong id="totalFine"></strong>
                                                            </small>
                                                            <form action="/gotoPayPageFine"
                                                                  onSubmit="return SaveFineHistory()"
                                                                  method="post"
                                                                  onkeydown="if(event.keyCode==13)return false;">
                                                                <input id="payuserName" type="hidden" name="payusername"
                                                                       value="">
                                                                <input id="fineTitle" type="hidden" name="orderTitle"
                                                                       value=""/>
                                                                <input id="fineMoney" type="hidden" name="orderMoney"
                                                                       value="">
                                                                <button id="payForFineBtn" type="submit"
                                                                        class="col-md-offset-8 btn btn-primary btn-lg">
                                                                    Pay for fine
                                                                </button>
                                                            </form>
                                                        </h1>
                                                    </div>
                                                    <div id="fineValueList">

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <script type="text/javascript">
                                            var sumFine = 0;
                                            var jsonData = null;
                                            var correctUsername;
                                            $("#searchUserFineValueBtn").click(function () {
                                                var username = $("#searchUserFineValue").val();
                                                $.ajax({
                                                    url: "/librarian/searchFineValue",
                                                    type: "post",
                                                    dataType: "text",
                                                    data: {
                                                        "userName": username
                                                    },
                                                    success: function (data) {
                                                        if (data == "error") {
                                                            document.getElementById("fineValueList").innerHTML = "";
                                                            $("#fineMoney").attr("value", "0");
                                                            $("#totalFine").text("Total fine  (yuan)");
                                                        } else {
                                                            sumFine = 0;
                                                            document.getElementById("fineValueList").innerHTML = "";
                                                            correctUsername = username;
                                                            jsonData = eval("(" + data + ")");
                                                            $(jsonData).each(function () {
                                                                sumFine = parseInt(sumFine) + parseInt(this.fine);
                                                                $("#fineValueList").append(
                                                                    "<div class='container' style='margin-top: 20px'>" +
                                                                    "<div class='row clearfix'>" +
                                                                    "<div class= 'col-md-2 column' > " +
                                                                    "<label class='control-label '>Picture</label>" +
                                                                    "<hr>" +
                                                                    "<div> " +
                                                                    "<img id='searchedResultPic' alt='No Picture' style='width: 100px;height: 180px;' src='/bookpicture/" + this.bookImage + "'/>" +
                                                                    "</div>" +
                                                                    "</div>" +
                                                                    "<form class= 'form-horizontal' > " +
                                                                    "<div class= 'col-md-10 column' > " +
                                                                    "<div class= 'form-group' > " +
                                                                    "<input style='display: none;' name='bookId' value='" + this.id + "'>" +
                                                                    "<label for='bookName' class='col-sm-2 control-label'>Book Name:</label>" +
                                                                    "<div class=\"col-sm-3\">" +
                                                                    "<input name='bookName' class='form-control cantEdit' disabled='disabled'value = '" + this.bookName + "' > " +
                                                                    "</div>" +
                                                                    " <label for='author' class='col-sm-2 control-label'>fine:</label>" +
                                                                    "<div class=\"col-sm-3\">" +
                                                                    "<input name='author' class='form-control cantEdit' disabled='disabled' value = '" + this.fine + " (yuan) ' > " +
                                                                    "</div>" +
                                                                    "</div>" +
                                                                    "<div class = 'form-group' > " +
                                                                    " <label for='author' class='col-sm-2 control-label'>Borrow date:</label>" +
                                                                    "<div class =\"col-sm-3\">" +
                                                                    " <input name='author' class='form-control cantEdit' disabled='disabled' value = '" + this.borrowDate + "' > " +
                                                                    " </div>" +
                                                                    " <label for='author' class='col-sm-2 control-label'>Shoule return date:</label>" +
                                                                    " <div class=\"col-sm-3\">" +
                                                                    " <input name='author' class='form-control cantEdit' disabled='disabled' value = '" + this.shouldReturnDate + "' > " +
                                                                    " </div>" +
                                                                    " </div>" +
                                                                    " </form>");
                                                            });
                                                            $("#totalFine").text("Total fine " + sumFine + " (yuan)");
                                                            $("#fineMoney").attr("value", sumFine);
                                                            $("#fineTitle").attr("value", "pay for fine.");
                                                            $("#payuserName").attr("value", username);
                                                        }
                                                    }
                                                })
                                            });


                                            function SaveFineHistory() {
                                                if ($("#fineMoney").attr("value") == "" || $("#fineMoney").attr("value") == "0") {
                                                    alert("Pay Fine Should Bigger Than Zero");
                                                    return false;
                                                } else {
                                                    $.ajax({
                                                        url: "/librarian/saveFineHistoryInformation",
                                                        type: "post",
                                                        dataType: "text",
                                                        data: {
                                                            "jsonData": JSON.stringify(jsonData),
                                                            "readerName": correctUsername
                                                        },
                                                        success: function (data) {
                                                            if (data == "borrowhistorynotpresent") {
                                                                alert("This Book Fine Has Been Changed");
                                                            }
                                                        }
                                                    });
                                                    return true;
                                                }
                                            }
                                        </script>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="historyPanel">
                                <div class="container">
                                    <div class="row clearfix">
                                        <div class="col-md-12">
                                            <form class="navbar-form navbar-right" role="search">
                                                <h3 class="control-label">
                                                    <small>
                                                        Input Reader Username ;
                                                    </small>
                                                </h3>
                                                <div class="form-group">
                                                    <input type="number" class="form-control"
                                                           id="searchTheReaderFineInput"
                                                           name="searchName"/>
                                                </div>
                                                <button type="button" id="searchTheReaderFineBtn"
                                                        class="btn btn-default"
                                                        onclick="LibrariansearchTheReaderFineBtn()">Search
                                                </button>
                                            </form>
                                            <script type="text/javascript">
                                                function LibrariansearchTheReaderFineBtn() {
                                                    var username = $("#searchTheReaderFineInput").val();
                                                    if (username == "") {
                                                        alert("Username Can't Be Null");
                                                    } else {
                                                        $.ajax({
                                                            url: "/librarian/searchReaderFineHistory",
                                                            type: "post",
                                                            data: {
                                                                "username": username
                                                            },
                                                            dataType: "text",
                                                            success: function (data) {
                                                                if (data == "No Recored") {
                                                                    alert("This Reader Has No Fine Record");
                                                                    document.getElementById("readerPayFineHistoryList").innerHTML = "";
                                                                } else {
                                                                    var jsonData = eval(data);
                                                                    document.getElementById("readerPayFineHistoryList").innerHTML = "";
                                                                    $(jsonData).each(function () {
                                                                        $("#readerPayFineHistoryList").append(
                                                                            "                               <tr> " +
                                                                            "                                <td>\n" + this.bookId +
                                                                            "                                </td>\n" +
                                                                            "                                <td>\n" + this.bookName +
                                                                            "                                </td>\n" +
                                                                            "                                <td>\n" + this.returnDate +
                                                                            "                                </td>\n" +
                                                                            "                                <td>\n" + this.borrowDate +
                                                                            "                                </td>\n" +
                                                                            "                                <td>\n" + this.fineValue +
                                                                            "                                </td>\n" +
                                                                            "                            </tr>"
                                                                        );
                                                                    })
                                                                }
                                                            }
                                                        })
                                                    }
                                                }
                                            </script>
                                            <table class="table table-bordered">
                                                <thead>
                                                <tr>
                                                    <th>
                                                        BookId
                                                    </th>
                                                    <th>
                                                        BookName
                                                    </th>
                                                    <th>
                                                        PayDate
                                                    </th>
                                                    <th>
                                                        BorrowDate
                                                    </th>
                                                    <th>
                                                        Fine
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody id="readerPayFineHistoryList">

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="tab-pane" id="libraryIncomeDiv" sec:authorize="hasRole('ROLE_LIBRARIAN')">
            <div class="container">
                <div class="row clearfix">
                    <div class="col-md-12 column">
                        <div id="tabs-229853" style="margin-top: 20px">
                            <ul class="nav nav-tabs">
                                <li class="active">
                                    <a href="#yearlyView" data-toggle="tab">Annual</a>
                                </li>
                                <li>
                                    <a href="#monthlyView" data-toggle="tab">Monthly</a>
                                </li>
                                <li>
                                    <a href="#dailyView" data-toggle="tab">Daily</a>
                                </li>
                                <li>
                                    <a href="#weeklyView" data-toggle="tab">Weekly</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="yearlyView">
                                    <div class="container">
                                        <div class="row clearfix">
                                            <div class="col-md-3 column" style="border-right:1px solid black">
                                                <div style="margin-top: 20px">
                                                    <input id="yeardateTimePicker" class="form-control col-md-3">
                                                    <button type="button"
                                                            class="btn btn-primary btn-default pull-right"
                                                            id="searchYearInfo">Search
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-9 column">
                                                <div id="yearChartShow" style="width: 850px;height: 580px;">

                                                </div>
                                            </div>
                                            <script>
                                                $("#yeardateTimePicker").datetimepicker({
                                                    language: 'zh-CN',
                                                    format: 'yyyy',
                                                    weekStart: 1,
                                                    todayBtn: 1,
                                                    autoclose: 1,
                                                    todayHighlight: 1,
                                                    startView: 4,
                                                    minView: 4
                                                });

                                                var myChart;
                                                $("#searchYearInfo").click(function () {
                                                    if (myChart != null && myChart != "" && myChart != undefined) {
                                                        myChart.dispose();
                                                    }
                                                    $.ajax({
                                                        url: "/librarian/searchYearInfo",
                                                        type: "post",
                                                        dataType: "text",
                                                        data: {
                                                            "requestTime": $("#yeardateTimePicker").val()
                                                        },
                                                        success: function (data) {
                                                            if (data != "error") {
                                                                var fine = 0;
                                                                var deposit = 0;
                                                                if (data == "noincome") {
                                                                    fine = 0;
                                                                    deposit = 0;
                                                                } else {
                                                                    var jsonData = eval("(" + data + ")");
                                                                    fine = jsonData.fineIncome;
                                                                    deposit = jsonData.depositIncome;
                                                                }
                                                                var TotalFAndD = parseInt(fine) + parseInt(deposit);
                                                                myChart = echarts.init(document.getElementById('yearChartShow'));
                                                                var title = "This Year Total Income is " + TotalFAndD + " (yuan)";
                                                                var subtext = 'Total Fine ' + fine + ' (yuan), Total Deposit ' + deposit + ' (yuan)';


                                                                var option = {
                                                                    title: {
                                                                        text: title,
                                                                        subtext: subtext
                                                                    },
                                                                    tooltip: {},
                                                                    legend: {
                                                                        data: ['Income']
                                                                    },
                                                                    xAxis: {
                                                                        data: ["", "", "fine", "deposit", "", ""]
                                                                    },
                                                                    yAxis: {},
                                                                    series: [{
                                                                        name: 'Income',
                                                                        type: 'bar',
                                                                        data: [0, 0, fine, deposit, 0, 0]
                                                                    }]
                                                                };
                                                                myChart.setOption(option);
                                                            }
                                                        }
                                                    })
                                                });
                                            </script>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="monthlyView">
                                    <div class="container">
                                        <div class="row clearfix">
                                            <div class="col-md-3 column" style="border-right:1px solid black">
                                                <div style="margin-top: 20px">
                                                    <input id="monthlydateTimePicker" class="form-control col-md-3">
                                                    <button id="searchMonthlyInfo" type="button"
                                                            class="btn btn-primary btn-default pull-right">Search
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-9 column">
                                                <div id="monthChartShow" style="width: 850px;height: 580px;">

                                                </div>
                                            </div>
                                            <script type="text/javascript">
                                                $("#monthlydateTimePicker").datetimepicker({
                                                    language: 'zh-CN',
                                                    format: 'yyyy-mm',
                                                    weekStart: 1,
                                                    todayBtn: 1,
                                                    autoclose: 1,
                                                    todayHighlight: 1,
                                                    startView: 3,
                                                    minView: 3
                                                });
                                                var myChart;
                                                $("#searchMonthlyInfo").click(function () {
                                                    if (myChart != null && myChart != "" && myChart != undefined) {
                                                        myChart.dispose();
                                                    }
                                                    $.ajax({
                                                        url: "/librarian/searchMonthlyInfo",
                                                        type: "post",
                                                        dataType: "text",
                                                        data: {
                                                            "requestTime": $("#monthlydateTimePicker").val()
                                                        },
                                                        success: function (data) {
                                                            if (data != "error") {
                                                                var fine = 0;
                                                                var deposit = 0;
                                                                if (data == "noincome") {
                                                                    fine = 0;
                                                                    deposit = 0;
                                                                } else {
                                                                    var jsonData = eval("(" + data + ")");
                                                                    fine = jsonData.fineIncome;
                                                                    deposit = jsonData.depositIncome;
                                                                }
                                                                var allIncome = parseInt(fine) + parseInt(deposit);
                                                                myChart = echarts.init(document.getElementById('monthChartShow'));
                                                                var title = "This Month Total Income is " + allIncome + " (yuan)";
                                                                var subtext = 'Total Fine ' + fine + ' (yuan), Total Deposit ' + deposit + ' (yuan)';
                                                                var option = {
                                                                    title: {
                                                                        text: title,
                                                                        subtext: subtext
                                                                    },
                                                                    tooltip: {},
                                                                    legend: {
                                                                        data: ['Income']
                                                                    },
                                                                    xAxis: {
                                                                        data: ["", "", "fine", "deposit", "", ""]
                                                                    },
                                                                    yAxis: {},
                                                                    series: [{
                                                                        name: 'Income',
                                                                        type: 'bar',
                                                                        data: [0, 0, fine, deposit, 0, 0]
                                                                    }]
                                                                };
                                                                myChart.setOption(option);
                                                            }
                                                        }
                                                    })
                                                });

                                            </script>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="dailyView">
                                    <div class="container">
                                        <div class="row clearfix">
                                            <div class="col-md-3 column" style="border-right:1px solid black">
                                                <div style="margin-top: 20px">
                                                    <input id="dailydateTimePicker" class="form-control col-md-3">
                                                    <button type="button"
                                                            id="searchDailyInfo"
                                                            class="btn btn-primary btn-default pull-right">Search
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="dailyShowTable" class="col-md-9 column">
                                                <div id="dayChartShow" style="width: 850px;height: 580px;">

                                                </div>
                                            </div>
                                            <script>
                                                $("#dailydateTimePicker").datetimepicker({
                                                    language: 'zh-CN',
                                                    format: 'yyyy-mm-dd',
                                                    weekStart: 1,
                                                    todayBtn: 1,
                                                    autoclose: 1,
                                                    todayHighlight: 1,
                                                    startView: 3,
                                                    minView: 2
                                                });
                                                var myChart;
                                                $("#searchDailyInfo").click(function () {
                                                    if (myChart != null && myChart != "" && myChart != undefined) {
                                                        myChart.dispose();
                                                    }
                                                    $.ajax({
                                                        url: "/librarian/searchdailyInfo",
                                                        type: "post",
                                                        dataType: "text",
                                                        data: {
                                                            "requestTime": $("#dailydateTimePicker").val()
                                                        },
                                                        success: function (data) {
                                                            if (data != "error") {
                                                                var fine = 0;
                                                                var deposit = 0;
                                                                if (data == "noincome") {
                                                                    fine = 0;
                                                                    deposit = 0;
                                                                } else {
                                                                    var jsonData = eval("(" + data + ")");
                                                                    fine = jsonData.fineIncome;
                                                                    deposit = jsonData.depositIncome;
                                                                }
                                                                var totalIncome = parseInt(fine) + parseInt(deposit);
                                                                myChart = echarts.init(document.getElementById('dayChartShow'));
                                                                var title = "This Day Total Income is " + totalIncome + " (yuan)";
                                                                var subtext = 'Total Fine ' + fine + ' (yuan), Total Deposit ' + deposit + ' (yuan)';
                                                                var option = {
                                                                    title: {
                                                                        text: title,
                                                                        subtext: subtext
                                                                    },
                                                                    tooltip: {},
                                                                    legend: {
                                                                        data: ['Income']
                                                                    },
                                                                    xAxis: {
                                                                        data: ["", "", "fine", "deposit", "", ""]
                                                                    },
                                                                    yAxis: {},
                                                                    series: [{
                                                                        name: 'Income',
                                                                        type: 'bar',
                                                                        data: [0, 0, fine, deposit, 0, 0]
                                                                    }]
                                                                };
                                                                myChart.setOption(option);
                                                            }
                                                        }
                                                    })
                                                });

                                            </script>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" id="weeklyView">
                                    <div class="container">
                                        <div class="row clearfix">
                                            <div class="col-md-3 column" style="border-right:1px solid black">
                                                <div style="margin-top: 20px">
                                                    <input id="weeklydateTimePicker" class="form-control col-md-3">
                                                    <button type="button"
                                                            id="searchWeeklyInfo"
                                                            class="btn btn-primary btn-default pull-right">Search
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="weeklyShowTable" class="col-md-9 column">
                                                <div id="weeklyChartShow" style="width: 850px;height: 580px;">

                                                </div>
                                            </div>
                                            <script>
                                                $("#weeklydateTimePicker").datetimepicker({
                                                    language: 'zh-CN',
                                                    format: 'yyyy-mm-dd',
                                                    weekStart: 1,
                                                    todayBtn: 1,
                                                    autoclose: 1,
                                                    todayHighlight: 1,
                                                    startView: 3,
                                                    minView: 2
                                                });
                                                var myChart;
                                                $("#searchWeeklyInfo").click(function () {
                                                    if (myChart != null && myChart != "" && myChart != undefined) {
                                                        myChart.dispose();
                                                    }
                                                    $.ajax({
                                                        url: "/librarian/searchWeeklyInfo",
                                                        type: "post",
                                                        dataType: "text",
                                                        data: {
                                                            "weekTime": $("#weeklydateTimePicker").val()
                                                        },
                                                        success: function (data) {
                                                            if (data != "error") {

                                                                var jsonData = eval("(" + data + ")");
                                                                var fine = jsonData.fineIncome;
                                                                var deposit = jsonData.depositIncome;
                                                                myChart = echarts.init(document.getElementById('weeklyChartShow'));
                                                                var option = {
                                                                    title: {
                                                                        text: 'This Week Total Income is ' + jsonData.totalIncome + ' (yuan)',
                                                                        subtext: 'Total Fine ' + jsonData.totalFine + ' (yuan), Total Deposit ' + jsonData.totalDeposit + ' (yuan)'
                                                                    },
                                                                    tooltip: {
                                                                        trigger: 'axis',
                                                                        axisPointer: {
                                                                            type: 'shadow'
                                                                        }
                                                                    },
                                                                    legend: {
                                                                        data: ['Deposit', 'Fine']
                                                                    },
                                                                    grid: {
                                                                        left: '3%',
                                                                        right: '4%',
                                                                        bottom: '3%',
                                                                        containLabel: true
                                                                    },
                                                                    xAxis: {
                                                                        type: 'value',
                                                                        boundaryGap: [0, 0.01]
                                                                    },
                                                                    yAxis: {
                                                                        type: 'category',
                                                                        data: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
                                                                    },
                                                                    series: [
                                                                        {
                                                                            name: 'Deposit',
                                                                            type: 'bar',
                                                                            data: [jsonData.mondayDeposit, jsonData.tuesdayDeposit, jsonData.wednesdayDeposit,
                                                                                jsonData.thursdayDeposit, jsonData.fridayDeposit, jsonData.saturdayDeposit, jsonData.sundayDeposit]
                                                                        },
                                                                        {
                                                                            name: 'Fine',
                                                                            type: 'bar',
                                                                            data: [jsonData.mondayFine, jsonData.tuesdayFine, jsonData.wednesdayFine, jsonData.thursdayFine,
                                                                                jsonData.fridayFine, jsonData.saturdayFine, jsonData.sundayFine]
                                                                        }
                                                                    ]
                                                                };
                                                                myChart.setOption(option);
                                                            }
                                                        }
                                                    })
                                                });

                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="managementReaderAccountDiv" sec:authorize="hasRole('ROLE_LIBRARIAN')">
            <ul class="nav nav-tabs">
                <li class="active">
                    <a href="#panel-AddReader" data-toggle="tab">Add Reader</a>
                </li>
                <li>
                    <a href="#panel-readerInfo" data-toggle="tab">Reader Info</a>
                </li>
                <li>
                    <a href="#panel-borrowHistory" data-toggle="tab">Borrow History</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="panel-AddReader">
                    <div class="container" style="margin-top: 50px">
                        <div class="row clearfix">
                            <div class="col-md-1 column">
                            </div>
                            <div class="col-md-8 column">
                                <form class="form-horizontal" role="form" th:action="@{/gotoPayPageDeposit}"
                                      method="post"
                                      onsubmit="return checkVerficationCode();"
                                      onkeydown="if(event.keyCode==13)return false;">
                                    <div class="form-group">
                                        <div class="col-sm-2">
                                        </div>
                                        <label for="TelephoneNumber" class="col-sm-4 control-label" th:maxlength="11"
                                               onblur="">Telephone
                                            Number :</label>
                                        <div class="col-sm-4">
                                            <input type="number" minlength="11" maxlength="11" name="telephone"
                                                   class="form-control"
                                                   id="TelephoneNumber"/>
                                        </div>
                                        <div class="col-sm-2">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-2">
                                        </div>
                                        <label for="EmailAddress" class="col-sm-4 control-label">Email :</label>
                                        <div class="col-sm-4">
                                            <input type="email" name="email" class="form-control" id="EmailAddress"/>
                                        </div>
                                        <div class="col-sm-2">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-2">
                                        </div>
                                        <label for="inputReaderPassword" class="col-sm-4 control-label">Password
                                            :</label>
                                        <div class="col-sm-4">
                                            <input type="password" readonly="readonly" name="password" value="12345678"
                                                   class="form-control"
                                                   id="inputReaderPassword"/>
                                        </div>
                                        <div class="col-sm-2">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-2">
                                        </div>
                                        <label for="VerificationCode" class="col-sm-4 control-label">Verification
                                            code</label>
                                        <div class="col-sm-2">
                                            <input type="number" name="verificationCode" class="form-control"
                                                   id="VerificationCode"/>
                                        </div>
                                        <div class="col-sm-2">
                                            <button type="button" class="btn btn-default btn-info"
                                                    onclick="sendNotificationCode()" id="sendVerficationCodeBtn">Send
                                                Verfication Code
                                            </button>
                                        </div>
                                        <div class="col-sm-2">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-offset-6 col-sm-2">
                                            <button type="submit" class="btn btn-default  btn-primary">Pay Deposit and
                                                Register
                                            </button>
                                        </div>
                                    </div>
                                </form>
                                <script>


                                    var verficationCode;

                                    function checkVerficationCode() {
                                        var codeInput = $("#VerificationCode").val();
                                        if (codeInput == verficationCode) {
                                            return true;
                                        } else {
                                            alert("The Verfication Code Not Correct");
                                            return false;
                                        }
                                    }

                                    function sendNotificationCode() {
                                        //在这之前应该增加一个检测电话号码是否正确
                                        $("#sendVerficationCodeBtn").attr("disabled", true);
                                        var telephoneNumber = $("#TelephoneNumber").val();
                                        $.ajax({
                                            url: "/librarian/sendNotificationCode",
                                            type: "post",
                                            dataType: "text",
                                            async: false,
                                            data: {
                                                "telephone": telephoneNumber
                                            },
                                            success: function (data) {
                                                verficationCode = data;
                                                alert("We Have Send Verfication Code To Your Phone.");
                                                $("#sendVerficationCodeBtn").attr("disabled", false);
                                            }
                                        })
                                    }
                                </script>
                            </div>
                            <div class="col-md-3 column">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="panel-readerInfo">
                    <div class="container">
                        <div class="row clearfix">
                            <form class="navbar-form navbar-right" role="search">
                                <h3 class="control-label">
                                    <small>
                                        Input Reader Username Or Id ;
                                    </small>
                                </h3>
                                <div class="form-group">
                                    <input type="number" class="form-control" id="searchTheReaderIdInput"
                                           name="searchName"/>
                                </div>
                                <button type="button" id="searchTheReaderIdBtn" class="btn btn-default"
                                        onclick="searchTheReaderInformation()">Search
                                </button>
                            </form>
                            <script type="text/javascript">
                                function searchTheReaderInformation() {
                                    var tempVal = $("#searchTheReaderIdInput").val();
                                    if (tempVal == "") {
                                        alert("Input Can't Be Null.")
                                    } else {
                                        $.ajax({
                                            url: "/librarian/searchReader",
                                            type: "post",
                                            dataType: "text",
                                            data: {
                                                "readerId": tempVal
                                            },
                                            success: function (data) {
                                                if (data == "nouser") {
                                                    alert("This User Is Not Present");
                                                    document.getElementById("userInformationTable").innerHTML = "";
                                                } else {
                                                    document.getElementById("userInformationTable").innerHTML = "";
                                                    var jsonData = eval("(" + data + ")");
                                                    $("#userInformationTable").append(" <tr>" +
                                                        "                        <td>" + jsonData.id +
                                                        "                        </td>" +
                                                        "                        <td>" + jsonData.telephone +
                                                        "                        </td>" +
                                                        "                        <td>" + jsonData.email +
                                                        "                        </td>" +
                                                        "                        <td> <a onclick='editReaderInformation(\"" + jsonData.id + "\",this)'>edit</a>" +
                                                        "                        </td>" +
                                                        "                        <td><a href='javascript:void(0)' onclick='resetReaderPassword(" + jsonData.id + ")'>reset password</a>" +
                                                        "                        </td>" +
                                                        "                        <td><a onclick='deleteThisReader(" + jsonData.id + ",\"" + jsonData.telephone + "\")'>delete</a>" +
                                                        "                        </td>" +
                                                        "                    </tr>");
                                                }
                                            }
                                        })
                                    }
                                }

                                function editReaderInformation(id, obj) {
                                    var newTelephone = prompt("Please Input New Telephone");
                                    if (newTelephone == null || newTelephone == "") {
                                        alert("Input Error");
                                    } else {
                                        $.ajax({
                                            url: "/librarian/editReaderUserInformation",
                                            dataType: "text",
                                            method: "post",
                                            data: {
                                                "newTelephone": newTelephone,
                                                "id": id
                                            },
                                            success: function (data) {
                                                if (data == "error") {
                                                    alert("Change Telephone Error")
                                                } else {
                                                    $(obj.parentNode.parentNode).children("td").eq(1).text(newTelephone);
                                                    iosOverlay({
                                                        text: "Success",
                                                        duration: 1000,
                                                        icon: "global/images/check.png"
                                                    });
                                                    //alert("Change Telephone Successfully");
                                                }
                                            }
                                        })
                                    }

                                }

                                function deleteThisReader(id, obj) {
                                    var myMessage = confirm("You Will Delete This Reader!");
                                    if (myMessage == true) {
                                        $.ajax({
                                            url: "/librarian/deleteReader",
                                            type: "post",
                                            dataType: "text",
                                            data: {
                                                "username": obj
                                            },
                                            success: function (data) {
                                                if (data == "nouser") {
                                                    alert("This User Is Not Present");
                                                } else if (data == "overdueAndLend") {
                                                    alert("Please Pay For And Fine Return Book");
                                                } else if (data == "lend") {
                                                    alert("Please Return Book");
                                                } else if (data == "overdue") {
                                                    alert("Please Pay Fine And Return Book")
                                                } else if (data == "ok") {
                                                    iosOverlay({
                                                        text: "Delete Success",
                                                        duration: 1000,
                                                        icon: "global/images/check.png"
                                                    });
                                                    //alert("Delete Successfully");
                                                }
                                            }
                                        })
                                    }
                                }

                                function resetReaderPassword(id) {
                                    $.ajax({
                                        url: "/librarian/resetPassword",
                                        type: "post",
                                        dataType: "text",
                                        data: {
                                            "id": id
                                        },
                                        success: function (data) {
                                            if (data == "ok") {
                                                iosOverlay({
                                                    text: "Success",
                                                    duration: 1000,
                                                    icon: "global/images/check.png"
                                                });
                                                //  alert("Reset Password Successfully.");
                                            }
                                        }
                                    })
                                }
                            </script>
                        </div>

                        <div class="page-header">
                            <h1>
                                <small>Reader Information</small>
                            </h1>
                        </div>
                        <table class="table table-bordered">
                            <thead>
                            <tr>
                                <th>
                                    Id
                                </th>
                                <th>
                                    Username
                                </th>
                                <th>
                                    Email
                                </th>
                                <!--<th>
                                    Password
                                </th>-->
                                <th>
                                    Edit
                                </th>
                                <th>
                                    Reset Password
                                </th>
                                <th>
                                    Delete This
                                </th>
                            </tr>
                            </thead>
                            <tbody id="userInformationTable">

                            </tbody>
                        </table>

                    </div>
                </div>
                <div class="tab-pane" id="panel-borrowHistory">
                    <div class="container">
                        <div class="row clearfix">
                            <div class="col-md-12 column">
                                <form class="navbar-form navbar-right" role="search">
                                    <h3 class="control-label">
                                        <small>
                                            Input Reader Username ;
                                        </small>
                                    </h3>
                                    <div class="form-group">
                                        <input type="number" class="form-control" id="searchReaderBorrowHistoryInput"/>
                                    </div>
                                    <button type="button" id="searchReaderBorrowHistoryBtn" class="btn btn-default"
                                            onclick="searchReaderBorrowHistory()">Search
                                    </button>
                                </form>
                                <script type="text/javascript">
                                    function searchReaderBorrowHistory() {
                                        $.ajax({
                                            url: "/librarian/searchReaderBorrowHistory",
                                            type: "post",
                                            dataType: "text",
                                            data: {
                                                "username": $("#searchReaderBorrowHistoryInput").val()
                                            },
                                            success: function (data) {
                                                if (data == "This Reader Have No Borrow History") {
                                                    alert("This Reader Doesn't Have Borrow History");
                                                    $("#ReaderTotallyFine").text(0);
                                                    document.getElementById("readerNotReturnBookList").innerHTML = "";
                                                    document.getElementById("hasReturnedBookList").innerHTML = "";
                                                    document.getElementById("readerOverDueBookList").innerHTML = "";
                                                } else {
                                                    var jsonData = eval("(" + data + ")");
                                                    var hasReturnBookList = jsonData.hasReturnBookList;
                                                    var notReturnBookList = jsonData.notReturnBookList;
                                                    var overDueBookList = jsonData.overDueBookList;
                                                    document.getElementById("readerNotReturnBookList").innerHTML = "";
                                                    $(notReturnBookList).each(function () {
                                                        $("#readerNotReturnBookList").append("<tr>" +
                                                            "                                <td>" + this.id +
                                                            "                                </td>" +
                                                            "                                <td >" + this.bookName +
                                                            "                                </td>" +
                                                            "                                <td>" + this.borrowDate +
                                                            "                                </td>" +
                                                            "                                <td>" + this.shouldReturnDate +
                                                            "                                </td>\n" +
                                                            "                            </tr>");
                                                    });

                                                    document.getElementById("hasReturnedBookList").innerHTML = "";
                                                    $(hasReturnBookList).each(function () {
                                                        $("#hasReturnedBookList").append("<tr class='success'>" +
                                                            "                                <td>" + this.id +
                                                            "                                </td>" +
                                                            "                                <td >" + this.bookName +
                                                            "                                </td>" +
                                                            "                                <td>" + this.borrowDate +
                                                            "                                </td>" +
                                                            "                                <td>" + this.shouldReturnDate +
                                                            "                                </td>" +
                                                            "                              <td>" + this.fine +
                                                            "                              </td>" +
                                                            "                               <td>" + this.comment +
                                                            "                               </td>" +
                                                            "                            </tr>");
                                                    });
                                                    var totalFine = 0;
                                                    document.getElementById("readerOverDueBookList").innerHTML = "";
                                                    $(overDueBookList).each(function () {
                                                        $("#readerOverDueBookList").append("<tr class='warning'>" +
                                                            "                                <td>" + this.id +
                                                            "                                </td>" +
                                                            "                                <td >" + this.bookName +
                                                            "                                </td>" +
                                                            "                                <td>" + this.borrowDate +
                                                            "                                </td>" +
                                                            "                                <td>" + this.shouldReturnDate +
                                                            "                                </td>" +
                                                            "                                <td>" + this.fine +
                                                            "                               </td>" +
                                                            "                            </tr>");
                                                        totalFine = parseInt(totalFine) + parseInt(this.fine);
                                                    });
                                                    $("#ReaderTotallyFine").text(totalFine);
                                                }
                                            }
                                        })
                                    }
                                </script>
                                <div class="page-header">
                                    <h1>
                                        <small>Not Return</small>
                                    </h1>
                                </div>
                                <table class="table table-striped">
                                    <thead>
                                    <tr>
                                        <th>
                                            Book id
                                        </th>
                                        <th>
                                            BookName
                                        </th>
                                        <th>
                                            Borrow Date
                                        </th>
                                        <th>
                                            Should Return Date
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody id="readerNotReturnBookList">
                                    </tbody>
                                </table>
                                <div class="page-header">
                                    <h1>
                                        <small>Overdue(total fine is <strong id="ReaderTotallyFine"> </strong> yuan )
                                        </small>
                                    </h1>

                                </div>
                                <table class="table table-striped">
                                    <thead>
                                    <tr>
                                        <th>
                                            Book id
                                        </th>
                                        <th>
                                            BookName
                                        </th>
                                        <th>
                                            Borrow Date
                                        </th>
                                        <th>
                                            Should Return Date
                                        </th>
                                        <th>
                                            Fine
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody id="readerOverDueBookList">

                                    </tbody>
                                </table>
                                <div class="page-header">
                                    <h1>
                                        <small>Has Been Returned</small>
                                    </h1>
                                </div>
                                <table class="table table-striped">
                                    <thead>
                                    <tr>
                                        <th>
                                            Book id
                                        </th>
                                        <th>
                                            BookName
                                        </th>
                                        <th>
                                            Borrow Date
                                        </th>
                                        <th>
                                            Returned Date
                                        </th>
                                        <th>
                                            Fine
                                        </th>
                                        <th>
                                            Comment
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody id="hasReturnedBookList">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="borrowBookDiv" sec:authorize="hasRole('ROLE_LIBRARIAN')">
            <div class="container">
                <div class="row clearfix">
                    <div class="col-md-12 column">
                        <div class="row clearfix">
                            <form class="form-horizontal" role="form">
                                <div class="form-group" style="margin-top: 50px;">
                                    <button type="button" class="btn btn-default btn-info col-lg-offset-10"
                                            id="addBorrowBook" onclick="addBorrowItem()">Add One
                                    </button>
                                    <button type="button" class="btn btn-default " id="borrowBookBtn"
                                            onclick="borrowBookFun()">Borrow Book
                                    </button>
                                </div>
                                <div class="page-header">
                                    <h1>
                                        <small>Borrow Information</small>
                                    </h1>
                                </div>
                                <div id="borrowBookItemList">
                                    <div class="form-group">
                                        <div class="col-md-2 displayVertival">
                                            <div class="text-center">
                                                <label class="control-label ">Picture : </label>
                                            </div>
                                            <div class="text-center">
                                                <img alt='No Picture' style='width: 100px;height: 150px;'>
                                            </div>
                                        </div>
                                        <div class="col-md-10">
                                            <div class="form-group bookBookItemClass">
                                                <label class="col-sm-2 control-label">bookId</label>
                                                <div class="col-sm-3">
                                                    <input type="number" class="form-control"
                                                           onblur="loadThePicture(this)">
                                                </div>
                                                <label class="col-sm-2 control-label ">username</label>
                                                <div class="col-sm-3">
                                                    <input type="number" class="form-control">
                                                </div>
                                                <button type='button' class='returnBookDeleteIco'
                                                        style='margin-left: 5px;'
                                                        onclick='borrowBookDeleteThisItem(this)'>×
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <script type="text/javascript">
                                function addBorrowItem() {
                                    $("#borrowBookItemList").append("<div class=\"form-group\"><hr>" +
                                        "                                        <div class=\"col-md-2 displayVertival\">\n" +
                                        "                                          <div class=\"text-center\">\n" +
                                        "                                                <label class=\"control-label \">Picture : </label>\n" +
                                        "                                            </div>\n" +
                                        "                                            <div class=\"text-center\">\n" +
                                        "                                                <img alt='No Picture' style='width: 100px;height: 150px;'>\n" +
                                        "                                            </div>" +
                                        "                                        </div>\n" +
                                        "                                        <div class=\"col-md-10\">\n" +
                                        "                                            <div class=\"form-group bookBookItemClass\">\n" +
                                        "                                                <label class=\"col-sm-2 control-label \">bookId</label>\n" +
                                        "                                                <div class=\"col-sm-3\">\n" +
                                        "                                                    <input type=\"number\" class=\"form-control\" onblur=\"loadThePicture(this)\">\n" +
                                        "                                                </div>\n" +
                                        "                                                <label class=\"col-sm-2 control-label \">username</label>\n" +
                                        "                                                <div class=\"col-sm-3\">\n" +
                                        "                                                    <input type=\"number\" class=\"form-control\">\n" +
                                        "                                                </div>\n" +
                                        "                                                <button type='button' class='returnBookDeleteIco' style='margin-left: 5px;'\n" +
                                        "                                                        onclick='borrowBookDeleteThisItem(this)'>×\n" +
                                        "                                                </button>" +
                                        "                                            </div>" +
                                        "                                        </div>" +
                                        "                                    </div>"
                                    )
                                    ;
                                }

                                function borrowBookDeleteThisItem(obj) {
                                    $(obj.parentNode.parentNode.parentNode).remove();
                                }

                                function loadThePicture(obj) {
                                    var father = $(obj.parentNode.parentNode.parentNode.parentNode).children('div').eq(0);
                                    var bookId = $(obj).val();
                                    if (bookId == "" || bookId == null) {
                                        alert("Input Can't Be NUll");
                                    } else {
                                        //更改名称
                                        $.ajax({
                                            url: "/librarian/searchOneBookNameAndPicNumber",
                                            dataType: "text",
                                            type: "post",
                                            data: {
                                                "bookId": bookId
                                            },
                                            success: function (data) {
                                                if (data != "error") {
                                                    var jsonData = eval("(" + data + ")");
                                                    father.children('div').eq(0).children('label').eq(0).text(jsonData.name);
                                                    father.children('div').eq(1).children('img').eq(0).attr("src", "/bookpicture/" + jsonData.bookPicNumber);
                                                } else if (data == "error") {
                                                    alert("This Book Is Not Present.")
                                                    $(obj).val("");
                                                }
                                            }
                                        });
                                    }
                                }

                                function borrowBookFun() {
                                    $(".bookBookItemClass").each(function () {
                                        var objItem = this;
                                        var InputBookId = $(this).children("div").eq(0).children("input").eq(0).val();
                                        var InputUserName = $(this).children("div").eq(1).children("input").eq(0).val();
                                        if (InputBookId == "" || InputUserName == "") {
                                            alert("Inpout can't Be Null String");
                                            return;
                                        } else {
                                            $.ajax({
                                                url: "/librarian/borrowOneBook",
                                                dataType: "text",
                                                type: "post",
                                                async: false,
                                                data: {
                                                    "bookId": InputBookId,
                                                    "userName": InputUserName
                                                },
                                                success: function (data) {
                                                    if (data == "notreader" || data == "nothisuser") {
                                                        alert("This Reader " + InputUserName + " Is Not Present.")
                                                    } else if (data == "Reached The Borrow Amount Upper Bound") {
                                                        alert("The user " + InputUserName + " has reached the upper limit of borrowing books.")
                                                    } else if ("this book has been reserved" == data) {
                                                        alert("this book " + InputBookId + " has been reserved")
                                                    } else if ("This Book Has Been Borrowed" == data) {
                                                        alert("This Book " + InputBookId + " Has Been Borrowed")
                                                    } else if (data == "ok") {
                                                        iosOverlay({
                                                            text: "Borrow Book Success",
                                                            duration: 1000,
                                                            icon: "global/images/check.png"
                                                        });
                                                        //alert("Borrow Book Successfully.");
                                                    } else if (data == "This Book Is Not Present") {
                                                        alert("This Book Is Not Present");
                                                    } else {
                                                        alert("Borrow Error Please Check Your Input.");
                                                    }
                                                }
                                            })
                                        }
                                    });

                                    document.getElementById("borrowBookItemList").innerHTML = "<div class=\"form-group\">\n" +
                                        "                                        <div class=\"col-md-2 displayVertival\">\n" +
                                        "                                            <div class=\"text-center\">\n" +
                                        "                                                <label class=\"control-label \">Picture : </label>\n" +
                                        "                                            </div>\n" +
                                        "                                            <div class=\"text-center\">\n" +
                                        "                                                <img alt='No Picture' style='width: 100px;height: 150px;'>\n" +
                                        "                                            </div>\n" +
                                        "                                        </div>\n" +
                                        "                                        <div class=\"col-md-10\">\n" +
                                        "                                            <div class=\"form-group bookBookItemClass\">\n" +
                                        "                                                <label class=\"col-sm-2 control-label\">bookId</label>\n" +
                                        "                                                <div class=\"col-sm-3\">\n" +
                                        "                                                    <input type=\"number\" class=\"form-control\"\n" +
                                        "                                                           onblur=\"loadThePicture(this)\">\n" +
                                        "                                                </div>\n" +
                                        "                                                <label class=\"col-sm-2 control-label \">username</label>\n" +
                                        "                                                <div class=\"col-sm-3\">\n" +
                                        "                                                    <input type=\"number\" class=\"form-control\">\n" +
                                        "                                                </div>\n" +
                                        "                                                <button type='button' class='returnBookDeleteIco'\n" +
                                        "                                                        style='margin-left: 5px;'\n" +
                                        "                                                        onclick='borrowBookDeleteThisItem(this)'>×\n" +
                                        "                                                </button>\n" +
                                        "                                            </div>\n" +
                                        "                                        </div>\n" +
                                        "                                    </div>";
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script th:inline="javascript">

    /* var header = $("meta[name=' _csrf_header']").attr("content");
                                        var token = $("meta[name='_csrf']").attr("content");*/

    $("#addReturnBook").click(function () {
        $("#returnBookItem").append("<div class=\"form-group retuBookItemClass\">\n" +
            "                                    <label\n" +
            "                                            class=\"col-sm-2 control-label \">bookId</label>\n" +
            "                                    <div class=\"col-sm-3\">\n" +
            "                                        <input type=\"text\" class=\"form-control \">\n" +
            "                                    </div>\n" +
            "                                    <label class=\"col-sm-2 control-label \">comment</label>\n" +
            "                                    <div class=\"col-sm-3\">\n" +
            "                                        <input type=\"text\" class=\"form-control \">\n" +
            "                                    </div>\n" +
            "                                    <button type='button' class='returnBookDeleteIco' style='margin-left: 5px;'\n" +
            "                                            onclick='deleteThisItem(this)'>×\n" +
            "                                    </button>\n" +
            "                                </div>");
    });

    function deleteThisItem(obj) {
        $(obj.parentNode).remove();
    }

    /*  var bookIdArr = [], bkx = 0;
      var bookComment = [], bcx = 0;

      $("#returnBookBtn").click(function () {

          $(".returnBook").each(function () {
              var tempVal = $(this).val();
              if (tempVal != "") {
                  bookIdArr[bkx++] = tempVal;
                  $(this).val("");
              }
          });

          $(" .comment").each(function () {
              var tempVal = $(this).val();
              if (tempVal != "") {
                  bookComment[bcx++] = tempVal;
                  $(this).val("");
              }
          });
          for (var i = 0; i < bookComment.length; i++) {
              $.ajax({
                  url: "/librarian/returnBook",
                  type: "post",
                  /!* beforeSend: function (xhr) {
                  xhr.setRequestHeader(header, token);
                  },*!/
                  data: {
                      "bookId": bookIdArr[i],
                      "comment": bookComment[i]
                  },
                  dataType: "text",
                  success: function (data) {
                  }
              })
          }
          bkx = 0;
          bcx = 0;
          document.getElementById("returnBookItem").innerHTML = "<div class=\"form-group\">\n" +
              " <label\n" +
              " class=\"col-sm-2 control-label \">bookId</label>\n" +
              "<div class=\"col-sm-3\">\n" +
              " <input type=\"text\" class=\"form-control returnBook\">\n" +
              "</div>" +
              " <label class=\"col-sm-2 control-label \">comment</label>\n" +
              " <div class=\"col-sm-3\">\n" +
              "<input type=\"text\" class=\"form-control comment\">\n" +
              "</div>\n" +
              "<button type =\"button\" class='returnBookDeleteIco' style='margin-left: 5px;'" +
              " onclick='deleteThisItem(this)'>×</button>" +
              "</div>";
      });*/

    //解析传回来的url然后进行相应额选项卡之间的跳转
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", 'i'); // 匹配目标参数
        var result = window.location.search.substr(1).match(reg); // 对querystring匹配目标参数
        if (result != null) {
            return decodeURIComponent(result[2]);
        } else {
            return null;
        }
    }

    var res = getQueryString("parm");
    if (res == 3) {
        $("#tab_addReader").click();
    }

</script>
<!--webSocket通讯-->
<script th:inline="javascript">
    var target = "ws://localhost:8080/talk";

    var ws = new WebSocket(target);
    var myname = $("#p_saveUserName").text();

    $(document).keydown(function (event) {
        if (event.which == 13 && event.shiftKey) {
            var messageVal = $("#inputannouncementCommentTextArea").val();
            $("#inputannouncementCommentTextArea").val("");
            messageVal = messageVal.trim();
            if (messageVal == "") {
                alert("can't send nullMessage.");
            } else {
                var currentTime = gettime();
                addMessageToDiv("news_my", myname, messageVal, currentTime);
                var obj = {
                    typeId: "0",//0表示聊天消息
                    senderName: myname,
                    messageContent: messageVal,
                    time: currentTime,
                    announceId: preId
                };
                var str = JSON.stringify(obj);
                ws.send(str);
            }
        }
    });

    ws.onmessage = function (ev) {
        var message = eval("(" + ev.data + ");");
        if (message.announceId == preId) {
            addMessageToDiv("news_others", message.senderName, message.messageContent, message.time);
        }
    };

    function addMessageToDiv(cssClass, senderName, content, time) {
        $("#announceMentBody").append("<div class=\"displayVertical\">" +
            "<div class=\"messageTimeStyle text-center\"> " +
            " " + time + "</div>" +
            "<div class=\"displayHorizontal\">" +
            "<div class= 'messageNameStyle' > " +
            " " + senderName +
            "</div>" +
            "<div class=\"" + cssClass + "\">" +
            " " + content + "</div>" +
            "</div>" +
            "</div>"
        );

        $("#announceMentBody").scrollTop($("#announceMentBody")[0].scrollHeight);
    }

</script>

<!--全局函数-->
<script>
    function trim(str) { //删除左右两端的空格
        return str.replace(/(^\s*)|(\s*$)/g, "");
    }

    function isNumber(str) {
        var reg = /^[1-9]+[0-9]*]*$/;
        if (reg.test(str)) {
            return true;
        } else {
            return false;
        }
    }
</script>
</html>